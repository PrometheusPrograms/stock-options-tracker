<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Options Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}?v=164">
    <style>
        .sticky-control-bar {
            position: sticky;
            top: 90px; /* Position right below sticky banner (banner height ~90px) */
            z-index: 98; /* Below banner (z-index: 999) but above content */
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 1rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            margin-top: -1.5rem; /* Pull up to fill gap */
            margin-bottom: 1.5rem; /* Add margin below for spacing to dashboard */
        }
        
        /* Date range button styling - remove outline on click and add selected state */
        .date-range-btn {
            outline: none !important;
            box-shadow: none !important;
            border: 1px solid rgba(255, 255, 255, 0.3) !important;
        }
        
        .date-range-btn:focus,
        .date-range-btn:active {
            outline: none !important;
            box-shadow: none !important;
        }
        
        .date-range-btn.selected {
            background-color: white !important;
            color: black !important;
            font-weight: bold !important;
            border-color: white !important;
        }
        
        .date-range-btn:not(.selected) {
            background-color: rgba(255, 255, 255, 0.2) !important;
            color: white !important;
        }
        
        /* Add a pseudo-element to fill the transparent gap */
        .sticky-control-bar::before {
            content: '';
            position: absolute;
            top: -1.5rem;
            left: 0;
            right: 0;
            height: 1.5rem;
            background-color: #f5f7fa; /* Match page background */
            z-index: -1;
        }
        
        .control-bar-content {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: center;
            justify-content: center;
        }
        
        .control-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .control-group label {
            color: white;
            font-weight: 500;
            font-size: 0.875rem;
            white-space: nowrap;
        }
        
        .quick-add-buttons {
            display: flex;
            gap: 0.25rem;
            flex-wrap: wrap;
        }
        
        .quick-add-btn {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
        }
        
        /* Flex container for trades and cost basis */
        .trades-cost-container {
            display: flex;
            flex-wrap: nowrap;
            width: 100%;
        }
        
        .transition-width {
            transition: width 0.3s ease-in-out;
        }
        
        #cost-basis-column {
            flex-shrink: 0;
        }
        
        #cost-basis-column.collapse:not(.show) {
            width: 0 !important;
            min-width: 0 !important;
            padding: 0 !important;
            margin: 0 !important;
            overflow: hidden !important;
        }
        
        #cost-basis-column.show {
            width: 33.333333% !important;
            flex: 0 0 33.333333%;
            overflow: visible;
        }
        
        #trades-column {
            flex: 1 1 auto;
            min-width: 0;
        }
        
        #trades-column .table-responsive {
            overflow-x: auto;
            max-width: 100%;
        }
        
        /* Floating toggle button for collapsed cost basis */
        .cost-basis-collapsed-toggle {
            position: fixed;
            right: 0;
            z-index: 1000;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 1rem 0.5rem;
            border-radius: 8px 0 0 8px;
            cursor: pointer;
            box-shadow: -2px 0 10px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            animation: slideInFromRight 0.3s ease;
        }
        
        .cost-basis-collapsed-toggle:hover {
            right: 5px;
            box-shadow: -4px 0 15px rgba(0,0,0,0.3);
        }
        
        @keyframes slideInFromRight {
            from {
                right: -50px;
                opacity: 0;
            }
            to {
                right: 0;
                opacity: 1;
            }
        }
        .floating-nav {
            position: fixed;
            left: 20px;
            top: calc(100vh / 3);
            width: 50px;
            background: #212529;
            border-radius: 12px;
            padding: 10px 8px;
            z-index: 1000;
            box-shadow: 0 6px 24px rgba(0, 0, 0, 0.5);
            cursor: move;
            user-select: none;
            border: 2px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(20px);
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .drag-handle {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 5px 0;
            color: #ffffff !important;
            cursor: grab;
            font-size: 24px;
            opacity: 1 !important;
            transition: all 0.2s ease;
            margin-bottom: 5px;
        }
        
        .drag-handle i {
            color: #ffffff !important;
            font-size: 18px !important;
        }
        
        .drag-handle:hover {
            background-color: rgba(13, 110, 253, 0.2);
            transform: scale(1.1);
        }
        
        .drag-handle:active {
            cursor: grabbing;
        }
        
        .nav-item {
            width: 34px;
            height: 34px;
            margin: 5px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s ease;
            color: #ffffff;
        }
        
        .nav-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }
        
        .nav-item i {
            font-size: 14px;
        }
        
        .nav-item.active {
            background: #0d6efd;
            color: white;
            box-shadow: 0 0 15px rgba(13, 110, 253, 0.8);
            transform: scale(1.05);
            border: 1px solid rgba(13, 110, 253, 0.5);
        }
        
        /* Dropdown submenu styling */
        .dropdown-submenu {
            position: relative;
        }
        
        .dropdown-submenu .dropdown-menu {
            top: 0;
            right: 100%;
            left: auto;
            margin-top: -1px;
            margin-right: 0;
            display: none;
            padding: 0;
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
        }
        
        /* Keep submenu open when hovering over parent item or submenu itself */
        .dropdown-submenu:hover > .dropdown-menu,
        .dropdown-submenu.show > .dropdown-menu,
        .dropdown-submenu .dropdown-menu:hover {
            display: block !important;
        }
        
        /* Ensure the submenu item itself maintains hover */
        .dropdown-submenu > .dropdown-item:hover + .dropdown-menu,
        .dropdown-submenu > .dropdown-item:hover ~ .dropdown-menu {
            display: block !important;
        }
        
        /* Add a small delay bridge to prevent accidental closing */
        .dropdown-submenu::after {
            content: '';
            position: absolute;
            top: 0;
            right: -5px;
            width: 5px;
            height: 100%;
            background: transparent;
            z-index: 1052;
        }
        
        .dropdown-submenu > .dropdown-toggle::after {
            transform: rotate(90deg);
            float: right;
            margin-top: 0.5rem;
        }
        
        /* Prevent parent dropdown from closing when clicking in submenu */
        .dropdown-submenu .dropdown-menu {
            pointer-events: auto;
        }
        
        #header-menu-dropdown {
            z-index: 1050;
        }
        
        #import-submenu {
            z-index: 1051;
            min-width: 250px;
        }
        
        /* Hamburger button styling */
        #header-menu-toggle {
            border: none !important;
            outline: none !important;
            box-shadow: none !important;
            width: 3rem;
            padding: 0.5rem;
        }
        
        #header-menu-toggle:focus,
        #header-menu-toggle:active,
        #header-menu-toggle:hover {
            border: none !important;
            outline: none !important;
            box-shadow: none !important;
        }
        
        /* Make all dropdown items show pointer cursor on hover */
        #header-menu-dropdown .dropdown-item {
            cursor: pointer;
        }
        
        #header-menu-dropdown .dropdown-item:hover {
            cursor: pointer;
            background-color: rgba(0, 0, 0, 0.05);
        }
        
        #header-menu-dropdown .dropdown-submenu > .dropdown-item:hover {
            cursor: pointer;
            background-color: rgba(0, 0, 0, 0.05);
        }
        
        /* Ensure both import type buttons are always visible and same size */
        #import-submenu .btn-group {
            display: flex !important;
            gap: 0.5rem !important;
        }
        
        #import-submenu .btn-group label {
            display: block !important;
            flex: 1 1 auto;
            width: 50% !important;
            min-width: 50% !important;
            max-width: 50% !important;
            padding: 0.25rem 0.5rem !important;
            text-align: center !important;
            border-radius: 0.375rem !important;
        }
        
        /* Ensure first button (Trades) has rounded corners on left */
        #import-submenu .btn-group label[for="import-type-trades"] {
            border-radius: 0.375rem !important;
        }
        
        /* Ensure second button (Cost Basis) has rounded corners on right */
        #import-submenu .btn-group label[for="import-type-cost-basis"] {
            border-radius: 0.375rem !important;
        }
        
        /* Ensure Trades and Cost Basis buttons are visually distinct when selected */
        #import-type-trades:checked + label[for="import-type-trades"],
        #import-type-cost-basis:checked + label[for="import-type-cost-basis"] {
            background-color: #0d6efd !important;
            border-color: #0d6efd !important;
            color: white !important;
            font-weight: 600;
        }
        
        /* Unselected state - make it clear both are visible */
        #import-type-trades:not(:checked) + label[for="import-type-trades"],
        #import-type-cost-basis:not(:checked) + label[for="import-type-cost-basis"] {
            background-color: transparent !important;
            border-color: #0d6efd !important;
            color: #0d6efd !important;
        }
        
        #import-type-trades:checked + label[for="import-type-trades"]:active,
        #import-type-cost-basis:checked + label[for="import-type-cost-basis"]:active {
            background-color: #0a58ca !important;
            border-color: #0a58ca !important;
        }
        
        /* Hover state for unselected buttons */
        #import-type-trades:not(:checked) + label[for="import-type-trades"]:hover,
        #import-type-cost-basis:not(:checked) + label[for="import-type-cost-basis"]:hover {
            background-color: rgba(13, 110, 253, 0.1) !important;
        }
        
        /* Cost basis ticker card - fixed width of 60px (fits 4 characters) */
        .cost-basis-ticker-card {
            width: 60px !important;
            min-width: 60px !important;
            max-width: 60px !important;
            height: 80px !important;
            overflow: hidden !important;
        }
        
        .cost-basis-ticker-card .card-body {
            overflow: hidden !important;
            padding: 0.5rem !important;
            height: 100% !important;
            display: flex !important;
            flex-direction: column !important;
            justify-content: center !important;
            align-items: center !important;
        }
        
        .cost-basis-ticker-card .card-body h6 {
            white-space: nowrap !important;
            overflow: hidden !important;
            text-overflow: ellipsis !important;
            margin: 0 !important;
            padding: 0 !important;
            width: 100% !important;
            display: block !important;
            text-align: center !important;
        }
    </style>
</head>
<body>
    <!-- Floating Navigation Bar -->
    <div class="floating-nav" id="floatingNav">
        <div class="drag-handle">
            <i class="fas fa-ellipsis-h"></i>
        </div>
        <div class="nav-item" onclick="scrollToSection('dashboard')" title="Dashboard">
            <i class="fas fa-tachometer-alt"></i>
        </div>
        <div class="nav-item" onclick="scrollToSection('trades')" title="Trades">
            <i class="fas fa-chart-line"></i>
        </div>
        <div class="nav-item" onclick="scrollToSection('cost-basis')" title="Cost Basis">
            <i class="fas fa-calculator"></i>
        </div>
    </div>

    <div class="page-wrapper">
        <!-- Header Banner -->
        <div class="header-banner-wrapper">
            <div class="header-banner d-flex justify-content-center align-items-center position-relative compact">
                <h1 class="text-center mb-0">
                    ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ Tracker
                </h1>
                <div class="position-absolute" style="right: 20px; top: 50%; transform: translateY(-50%);">
                    <button class="btn btn-link text-white p-0" type="button" id="header-menu-toggle" data-bs-toggle="dropdown" aria-expanded="false" style="cursor: pointer; font-size: 2.25rem; text-decoration: none; border: none; outline: none; width: 3rem; padding: 0.5rem;">
                        <i class="fas fa-bars"></i>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end" id="header-menu-dropdown" style="min-width: 250px;">
                        <li class="dropdown-item-text fw-bold">Menu</li>
                        <li><hr class="dropdown-divider"></li>
                        <li class="dropdown-item" onclick="toggleCommissionSettings()">
                            <i class="fas fa-percent me-2"></i>Commissions
                        </li>
                        <li class="dropdown-item" onclick="toggleBankrollSettings()">
                            <i class="fas fa-wallet me-2"></i>Bankroll
                        </li>
                        <li class="dropdown-submenu">
                            <a class="dropdown-item dropdown-toggle" href="#" role="button" id="import-submenu-toggle">
                                <i class="fas fa-file-excel me-2"></i>Import
                            </a>
                            <ul class="dropdown-menu" id="import-submenu">
                                <li class="px-3 py-2">
                                    <label class="form-label small mb-1">Account:</label>
                                    <select class="form-select form-select-sm" id="import-account-select">
                                        <option value="">Loading accounts...</option>
                                    </select>
                                </li>
                                <li class="px-3 py-2">
                                    <label class="form-label small mb-1">Type:</label>
                                    <div class="btn-group w-100" role="group" style="gap: 0.5rem;">
                                        <input type="radio" class="btn-check" name="import-type" id="import-type-trades" value="trades">
                                        <label class="btn btn-outline-primary btn-sm" for="import-type-trades" style="border-radius: 0.375rem !important;">Trades</label>
                                        <input type="radio" class="btn-check" name="import-type" id="import-type-cost-basis" value="cost-basis">
                                        <label class="btn btn-outline-primary btn-sm" for="import-type-cost-basis" style="border-radius: 0.375rem !important;">Cost Basis</label>
                                    </div>
                                </li>
                                <li class="px-3 py-2">
                                    <label class="form-label small mb-1">Import:</label>
                                    <label for="menu-excel-upload" class="btn btn-primary btn-sm w-100 mb-0" style="cursor: pointer;">
                                        <i class="fas fa-upload me-1"></i>Choose File
                                    </label>
                                    <input type="file" id="menu-excel-upload" name="file" accept=".xlsx,.xls,.xlsm" style="display: none;">
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- Sticky Control Bar -->
        <div class="sticky-control-bar">
            <div class="control-bar-content">
                <!-- Account Filter -->
                <div class="control-group">
                    <label for="universal-account-filter">Account:</label>
                    <select class="form-select form-select-sm" id="universal-account-filter" style="width: 150px;">
                        <option value="">All</option>
                    </select>
                </div>
                
                <!-- Quick Add Buttons -->
                <div class="control-group">
                    <label>Quick Add:</label>
                    <div class="quick-add-buttons">
                        <button class="btn btn-sm btn-light quick-add-btn" onclick="openROCTPutModal()">
                            <i class="fas fa-plus me-1"></i>ROCT PUT
                        </button>
                        <button class="btn btn-sm btn-light quick-add-btn" onclick="openROCTCallModal()">
                            <i class="fas fa-plus me-1"></i>ROCT CALL
                        </button>
                        <button class="btn btn-sm btn-light quick-add-btn" onclick="openBTOModal()">
                            <i class="fas fa-plus me-1"></i>BTO
                        </button>
                        <button class="btn btn-sm btn-light quick-add-btn" onclick="openSTCModal()">
                            <i class="fas fa-plus me-1"></i>STC
                        </button>
                    </div>
                </div>
                
                <!-- Universal Ticker Filter -->
                <div class="control-group">
                    <label for="universal-ticker-filter">Symbol:</label>
                    <div style="position: relative;">
                        <input type="text" class="form-control form-control-sm" id="universal-ticker-filter" placeholder="Filter by ticker..." style="width: 150px;" autocomplete="off">
                        <div id="universal-ticker-suggestions" class="dropdown-menu" style="display: none;"></div>
                    </div>
                    <button id="clear-universal-ticker" class="btn btn-sm btn-light" onclick="clearUniversalTickerFilter()" style="display: none;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <!-- Date Filters -->
                <div class="control-group">
                    <label for="universal-start-date">Start:</label>
                    <input type="date" class="form-control form-control-sm" id="universal-start-date" style="width: 140px;">
                </div>
                <div class="control-group">
                    <label for="universal-end-date">End:</label>
                    <input type="date" class="form-control form-control-sm" id="universal-end-date" style="width: 140px;">
                </div>
                
                <!-- Quick Date Buttons -->
                <div class="control-group">
                    <div class="btn-group btn-group-sm" id="universal-date-range-buttons">
                        <button class="btn btn-light date-range-btn" data-period="week" onclick="setUniversalDateRange('week')">1W</button>
                        <button class="btn btn-light date-range-btn" data-period="month" onclick="setUniversalDateRange('month')">1M</button>
                        <button class="btn btn-light date-range-btn" data-period="year" onclick="setUniversalDateRange('year')">1Y</button>
                        <button class="btn btn-light date-range-btn" data-period="ytd" onclick="setUniversalDateRange('ytd')">YTD</button>
                        <button class="btn btn-light date-range-btn" data-period="clear" onclick="clearUniversalDateFilters()">Clear</button>
                    </div>
                </div>
                
            </div>
        </div>
        
        <!-- Commission Settings Modal -->
        <div id="commission-modal" class="modal fade" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Commission Settings</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="commission-account-select" class="form-label">Account:</label>
                            <select class="form-select form-select-sm" id="commission-account-select">
                                <option value="">Loading accounts...</option>
                            </select>
                        </div>
                        
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h6 class="mb-0">Commission History</h6>
                            <button type="button" class="btn btn-sm btn-primary" onclick="openNewCommissionForm()">
                                <i class="fas fa-plus me-1"></i>New Commission
                            </button>
                        </div>
                        
                        <div id="commissions-table-container" class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                            <table class="table table-sm table-striped">
                                <thead class="table-light sticky-top">
                                    <tr>
                                        <th>Effective Date</th>
                                        <th>Commission Rate ($)</th>
                                        <th>Notes</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="commissions-table-body">
                                    <tr>
                                        <td colspan="4" class="text-center text-muted">Loading commissions...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- New/Edit Commission Form (initially hidden) -->
                        <div id="commission-form-container" style="display: none; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #dee2e6;">
                            <h6 id="commission-form-title">New Commission</h6>
                            <form id="commission-form">
                                <input type="hidden" id="commission-edit-id" value="">
                                <div class="row">
                                    <div class="col-md-4 mb-3">
                                        <label for="commission-rate-input" class="form-label">Commission Rate ($)</label>
                                        <input type="number" class="form-control form-control-sm" id="commission-rate-input" step="0.00001" min="0" max="999.99999" required>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label for="commission-effective-date-input" class="form-label">Effective Date</label>
                                        <input type="date" class="form-control form-control-sm" id="commission-effective-date-input" required>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label for="commission-notes-input" class="form-label">Notes (optional)</label>
                                        <input type="text" class="form-control form-control-sm" id="commission-notes-input">
                                    </div>
                                </div>
                                <div class="d-flex gap-2">
                                    <button type="submit" class="btn btn-sm btn-primary" id="commission-save-btn">Save</button>
                                    <button type="button" class="btn btn-sm btn-secondary" onclick="cancelCommissionForm()">Cancel</button>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dashboard Cards and Chart (Full Width) -->
        <div class="container-fluid px-0">
            <div class="row mb-5">
                <div class="col-12">
                    <div class="card section-card" id="dashboard" style="width: 100%;">
                    <div class="card-header bg-info text-white compact">
                        <div class="d-flex align-items-center justify-content-between">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-chevron-down section-toggle-icon" id="dashboardToggleIcon" data-bs-toggle="collapse" data-bs-target="#dashboardCollapse" aria-expanded="true" aria-controls="dashboardCollapse"></i>
                                <h5 class="mb-0 section-title" style="font-size: 1.875rem; font-weight: bold;">
                                    <i class="fas fa-tachometer-alt me-2"></i>
                                    Dashboard
                                </h5>
                                <!-- Old dashboard controls hidden - now in universal control bar -->
                                <div class="d-flex align-items-center dashboard-controls" style="gap: 2px; display: none !important;">
                                    <div class="d-flex align-items-center">
                                        <label for="dashboard-start-date" class="form-label form-label-sm text-white me-1 mb-0">Start</label>
                                        <input type="date" class="form-control form-control-sm dashboard-date-input" id="dashboard-start-date">
                                    </div>
                                    <div class="d-flex align-items-center">
                                        <label for="dashboard-end-date" class="form-label form-label-sm text-white me-1 mb-0">End</label>
                                        <input type="date" class="form-control form-control-sm dashboard-date-input" id="dashboard-end-date">
                                    </div>
                                    <button class="btn btn-sm btn-outline-light" onclick="setDashboardPeriod('week')">1W</button>
                                    <button class="btn btn-sm btn-outline-light" onclick="setDashboardPeriod('month')">1M</button>
                                    <button class="btn btn-sm btn-outline-light" onclick="setDashboardPeriod('year')">1Y</button>
                                    <button class="btn btn-sm btn-outline-light" onclick="setDashboardPeriod('ytd')">YTD</button>
                                    <button class="btn btn-sm btn-outline-light" onclick="clearDashboardFilters()">Clear</button>
                                </div>
                            </div>
                        </div>
                    </div>
                <div class="collapse show" id="dashboardCollapse">
                    <div class="card-body">
                        <div class="dashboard-content-container">
                <!-- First Row -->
                <div class="row mt-3">
                    <div class="col-md-6">
                        <div class="card bg-info text-white shadow-sm mb-3">
                            <div class="card-body text-center">
                                <div class="d-flex align-items-center justify-content-center mb-2">
                                    <i class="fas fa-dollar-sign fa-2x me-2"></i>
                                    <h6 class="card-title mb-0">Financial</h6>
                                </div>
                                <div class="row text-center">
                                    <div class="col-4">
                                        <h6 class="mb-1">Net Credit</h6>
                                        <p class="card-text h5 mb-0" id="total-net-credit">$0.00</p>
                                    </div>
                                    <div class="col-4">
                                        <h6 class="mb-1">Days Left</h6>
                                        <p class="card-text h5 mb-0" id="days-remaining">0</p>
                                    </div>
                                    <div class="col-4">
                                        <h6 class="mb-1">Days Done</h6>
                                        <p class="card-text h5 mb-0" id="days-done">0</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card bg-success text-white shadow-sm">
                            <div class="card-body text-center">
                                <div class="d-flex align-items-center justify-content-center mb-2">
                                    <i class="fas fa-star fa-2x me-2"></i>
                                    <h6 class="card-title mb-0">Top Symbols</h6>
                                </div>
                                <div id="top-symbols-list" class="text-center">
                                    <div class="text-center text-muted">
                                        <small>Loading...</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                
                <!-- Chart Row - Doughnut Chart and Daily Premium Chart -->
                <div class="row mt-3">
                    <div class="col-6">
                        <div class="card">
                            <div class="card-body d-flex flex-column">
                                <div class="d-flex align-items-center justify-content-center mb-3">
                                    <i class="fas fa-chart-pie fa-2x text-primary me-2"></i>
                                    <h6 class="card-title mb-0 text-primary">Trade Statistics</h6>
                                </div>
                                <div class="d-flex flex-grow-1 chart-container">
                                    <div class="d-flex flex-column justify-content-center me-3 legend-container">
                                        <div class="d-flex align-items-center mb-2">
                                            <div class="me-2 legend-item" style="background-color: #28a745;"></div>
                                            <div>
                                                <div class="fw-bold legend-text">Open</div>
                                                <small class="text-muted legend-subtext" id="legend-open-count">0 (0%)</small>
                                            </div>
                                        </div>
                                        <div class="d-flex align-items-center mb-2">
                                            <div class="me-2 legend-item" style="background-color: #ffc107;"></div>
                                            <div>
                                                <div class="fw-bold legend-text">Completed</div>
                                                <small class="text-muted legend-subtext" id="legend-completed-count">0 (0%)</small>
                                            </div>
                                        </div>
                                        <div class="d-flex align-items-center mb-2" style="padding-left: 20px;">
                                            <div class="me-2 legend-item" style="background-color: #17a2b8;"></div>
                                            <div>
                                                <div class="fw-bold legend-text">Wins</div>
                                                <small class="text-muted legend-subtext" id="legend-wins-count">0 (0%)</small>
                                            </div>
                                        </div>
                                        <div class="d-flex align-items-center" style="padding-left: 20px;">
                                            <div class="me-2 legend-item" style="background-color: #dc3545;"></div>
                                            <div>
                                                <div class="fw-bold legend-text">Losses</div>
                                                <small class="text-muted legend-subtext" id="legend-losses-count">0 (0%)</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="position-relative flex-grow-1 d-flex justify-content-center align-items-center">
                                        <div id="sunburst-chart" class="sunburst-chart"></div>
                                        <div class="position-absolute top-50 start-50 translate-middle text-center">
                                            <div class="h4 mb-0 text-primary" id="total-trades-center">0</div>
                                            <small class="text-muted">Total Trades</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="card">
                            <div class="card-body d-flex flex-column">
                                <div class="d-flex align-items-center justify-content-center mb-3">
                                    <i class="fas fa-wallet fa-2x text-success me-2"></i>
                                    <h6 class="card-title mb-0 text-success">Bankroll Allocation</h6>
                                </div>
                                <div class="d-flex flex-grow-1 flex-column justify-content-center">
                                    <div class="d-flex chart-container justify-content-center align-items-center mb-3">
                                        <div id="bankroll-chart" class="sunburst-chart"></div>
                                        <div class="ms-3 d-flex flex-column justify-content-center">
                                            <div class="d-flex align-items-center mb-2">
                                                <div class="me-2" style="width: 12px; height: 12px; background-color: #dc3545; border-radius: 50%;"></div>
                                                <div>
                                                    <div class="fw-bold">Used</div>
                                                    <small class="text-muted" id="bankroll-in-use">$0</small>
                                                </div>
                                            </div>
                                            <div class="d-flex align-items-center mb-2">
                                                <div class="me-2" style="width: 12px; height: 12px; background-color: #28a745; border-radius: 50%;"></div>
                                                <div>
                                                    <div class="fw-bold">Available</div>
                                                    <small class="text-muted" id="bankroll-available">$0</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-muted small mb-1">Total Bankroll</div>
                                        <div class="h4 mb-0 fw-bold" id="bankroll-total-display">$0</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Premium Chart Row -->
                <div class="row mt-3">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <h6 class="card-title">
                                    <i class="fas fa-chart-area text-primary me-2"></i>
                                    Daily Premium Over Time
                                </h6>
                                <div class="chart-container">
                                    <canvas id="premiumChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                        </div>
                    </div>
                </div>
                </div>
            </div>
        </div>
        </div>

        <!-- Trades and Cost Basis Section -->
        <div class="container-fluid px-0">
            <div class="trades-cost-container mb-5" style="margin-top: 2.25rem;">
                <!-- Trades Card (on the left) -->
                <div id="trades-column" class="transition-width me-3">
                    <div class="card section-card" id="trades" style="width: 100%;">
                    <div class="card-header bg-success text-white compact">
                        <div class="d-flex align-items-center justify-content-between">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-chevron-down section-toggle-icon" id="tradesToggleIcon" data-bs-toggle="collapse" data-bs-target="#tradesCollapse" aria-expanded="true" aria-controls="tradesCollapse"></i>
                                <h5 class="mb-0 section-title" style="font-size: 1.875rem; font-weight: bold;">
                                    <i class="fas fa-chart-line me-2"></i>
                                    Trades
                                </h5>
                                <!-- Old controls hidden - now in universal control bar -->
                                <div class="d-flex align-items-center ms-3" style="gap: 2px; display: none !important;">
                                    <label for="excel-upload" class="btn btn-sm btn-light mb-0 me-2" style="cursor: pointer;">
                                        <i class="fas fa-file-excel me-1"></i>Import Excel
                                    </label>
                                    <input type="file" id="excel-upload" name="file" accept=".xlsx,.xls,.xlsm" style="display: none;">
                                    <input type="text" class="form-control form-control-sm" id="symbol-filter" placeholder="Type symbol..." autocomplete="off" style="width: 180px;">
                                    <div id="symbol-suggestions" class="dropdown-menu filter-suggestions"></div>
                                    <button id="clear-symbol" class="btn btn-sm btn-outline-light clear-button" onclick="clearSymbolFilter()" style="display: none;">
                                        <i class="fas fa-times"></i>
                                    </button>
                                    <div class="d-flex align-items-center" style="gap: 1px;">
                                        <button id="jump-to-cost-basis" class="btn btn-sm btn-outline-light" onclick="jumpToCostBasis()" title="Jump to Cost Basis">
                                            <i class="fas fa-arrow-down"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-light" onclick="scrollToTop()" title="Jump to Dashboard">
                                            <i class="fas fa-level-up-alt"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <!-- Status Filter -->
                            <div class="d-flex align-items-center ms-3" style="gap: 1px;">
                                <label for="status-filter" class="form-label mb-0 me-1 text-white">Status:</label>
                                <select class="form-select form-select-sm status-filter" id="status-filter" style="width: 120px;">
                                    <option value="">All</option>
                                    <option value="open">Open</option>
                                    <option value="closed">Closed</option>
                                    <option value="assigned">Assigned</option>
                                    <option value="expired">Expired</option>
                                    <option value="roll">Roll</option>
                                </select>
                            </div>
                        </div>
                    </div>
                <div class="collapse show" id="tradesCollapse">
                    <div class="card-body">
                        <div class="dashboard-content-container">
                            <div class="row">
                                <!-- Old Add Trade box hidden - now in universal control bar -->
                                <div class="col-md-1" style="display: none;">
                                    <div class="card shadow-sm border-0">
                                        <div class="card-header bg-primary text-white">
                                            <h6 class="mb-0" style="font-size: 0.75rem;">
                                                <i class="fas fa-plus-circle me-1"></i>
                                                Add Trade
                                            </h6>
                                        </div>
                                        <div class="card-body p-1">
                                            <div class="d-grid gap-1">
                                                <button class="btn btn-outline-primary btn-sm" onclick="openBTOModal()">
                                                    BTO
                                                </button>
                                                <button class="btn btn-outline-primary btn-sm" onclick="addTradeType('BTC')">
                                                    BTC
                                                </button>
                                                <button class="btn btn-outline-primary btn-sm" onclick="openROCTCallModal()">
                                                    ROC
                                                </button>
                                                <button class="btn btn-outline-primary btn-sm" onclick="openROCTPutModal()">
                                                    ROP
                                                </button>
                                                <button class="btn btn-outline-primary btn-sm" onclick="openROCTCallModal()">
                                                    ROCT CALL
                                                </button>
                                                <button class="btn btn-outline-primary btn-sm" onclick="openROCTPutModal()">
                                                    ROCT PUT
                                                </button>
                                                <button class="btn btn-outline-primary btn-sm" onclick="openSTCModal()">
                                                    STC
                                                </button>
                                                <button class="btn btn-outline-primary btn-sm" onclick="addTradeType('STO')">
                                                    STO
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Trades Table -->
                                <div class="col-12">
                                    <div class="table-responsive">
                                        <table class="table table-sm table-fixed" id="trades-table-main">
                                            <tbody id="trades-table"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                    </div>
                </div>
                
                <!-- Cost Basis Card (on the right, collapsible) -->
                <div id="cost-basis-column" class="collapse show flex-shrink-0 transition-width">
                    <div class="card section-card" style="width: 100%;">
                        <div class="card-header bg-success text-white compact d-flex justify-content-between align-items-center">
                            <div>
                                <i class="fas fa-calculator me-2"></i>
                                <span>Cost Basis</span>
                            </div>
                            <button class="btn btn-sm btn-light" id="cost-basis-toggle-btn" onclick="toggleCostBasis()">
                                <i class="fas fa-chevron-right" id="cost-basis-toggle-icon"></i>
                            </button>
                        </div>
                        <div class="card-body" id="cost-basis-inline-container">
                            <!-- Cost basis content will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>
        
        <!-- Floating Toggle Button for Collapsed Cost Basis -->
        <button class="cost-basis-collapsed-toggle" id="cost-basis-floating-toggle" onclick="toggleCostBasis()" style="display: none;">
            <i class="fas fa-chevron-left fa-lg" id="cost-basis-floating-toggle-icon"></i>
        </button>

        <!-- Cost Basis Section (Hidden - now inline with trades) -->
        <div class="container-fluid px-0" style="display: none;">
            <div class="row mb-5" style="margin-top: 2.25rem;">
                <div class="col-12">
                    <div class="card section-card" id="cost-basis" style="width: 100%;">
                    <div class="card-header bg-success text-white compact">
                        <div class="d-flex align-items-center justify-content-between">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-chevron-down section-toggle-icon" id="costBasisToggleIcon" data-bs-toggle="collapse" data-bs-target="#costBasisCollapse" aria-expanded="true" aria-controls="costBasisCollapse"></i>
                                <h5 class="mb-0 section-title" style="font-size: 1.875rem; font-weight: bold;">
                                    <i class="fas fa-calculator me-2"></i>
                                    Cost Basis
                                </h5>
                                <!-- Old controls hidden - now in universal control bar -->
                                <div class="d-flex align-items-center ms-3" style="gap: 2px; display: none !important;">
                                    <input type="text" class="form-control form-control-sm" id="cost-basis-symbol-filter" placeholder="Type symbol..." style="width: 220px;" autocomplete="off">
                                    <div id="cost-basis-symbol-suggestions" class="dropdown-menu" style="display: none;"></div>
                                    <button id="clear-cost-basis-symbol" class="btn btn-sm btn-outline-light" style="display: none;" onclick="clearCostBasisSymbolFilter()">
                                        <i class="fas fa-times"></i>
                                    </button>
                                    <button id="jump-to-trades" class="btn btn-sm btn-outline-light" onclick="jumpToTradesTop()" title="Jump to Trades">
                                        <i class="fas fa-arrow-up"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-light" onclick="scrollToTop()" title="Jump to Dashboard">
                                        <i class="fas fa-level-up-alt"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                <div class="collapse show" id="costBasisCollapse">
                    <div class="card-body">
                        <div class="dashboard-content-container">
                            <div class="row">
                                <!-- Cost Basis Table (Full width like dashboard) -->
                                <div class="col-12">
                                    <div id="cost-basis-table-container"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                </div>
            </div>
        </div>
        </div>

    <!-- BTO Form Modal -->
    <div class="modal fade" id="btoModal" tabindex="-1" aria-labelledby="btoModalLabel" aria-hidden="true">
        <div class="modal-dialog" style="max-width: 350px;">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="btoModalLabel">
                        <i class="fas fa-plus-circle me-2"></i>
                        Add BTO Trade
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="btoForm">
                        <div class="mb-3">
                            <label for="bto-account" class="form-label">Account</label>
                            <select class="form-select" id="bto-account" name="accountId" required>
                                <option value="">Loading accounts...</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="bto-trade-date" class="form-label">Trade Date</label>
                            <input type="text" class="form-control" id="bto-trade-date" name="tradeDate" placeholder="DD-MMM-YY" data-display-format="DD-MMM-YY" data-edit-format="MM/DD/YY" onfocus="handleDateInputFocus(this)" onblur="handleDateInputBlur(this)" required>
                        </div>
                        <div class="mb-3">
                            <label for="bto-underlying" class="form-label">Underlying</label>
                            <div style="position: relative;">
                                <input type="text" class="form-control" id="bto-underlying" name="underlying" placeholder="Type ticker or company name..." autocomplete="off" required>
                                <div id="bto-underlying-suggestions" class="dropdown-menu" style="display: none;"></div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="bto-purchase-price" class="form-label">Purchase Price</label>
                            <div class="input-group">
                                <span class="input-group-text">$</span>
                                <input type="number" class="form-control" id="bto-purchase-price" name="purchasePrice" step="0.01" placeholder="0.00" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="bto-shares" class="form-label">Number of Shares</label>
                            <input type="number" class="form-control" id="bto-shares" name="shares" min="1" placeholder="1" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer d-flex flex-column">
                    <div class="d-flex w-100 mb-2" id="bto-add-buttons">
                        <button type="button" class="btn btn-primary flex-fill me-2" onclick="submitBTOForm('addAndClose')">
                            <i class="fas fa-save me-2"></i>
                            Add and Close
                        </button>
                        <button type="button" class="btn btn-success flex-fill" onclick="submitBTOForm('addAnother')">
                            <i class="fas fa-plus me-2"></i>
                            Add Another
                        </button>
                    </div>
                    <div class="d-flex justify-content-center w-100 mb-2" id="bto-add-cancel">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <i class="fas fa-times me-2"></i>
                            Cancel
                        </button>
                    </div>
                    <div class="d-flex w-100 mb-2" id="bto-edit-buttons" style="display: none !important;">
                        <button type="button" class="btn btn-primary flex-fill me-2" onclick="submitBTOForm('save')">
                            <i class="fas fa-save me-2"></i>
                            Save
                        </button>
                        <button type="button" class="btn btn-secondary flex-fill" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- STC Modal -->
    <div class="modal fade" id="stcModal" tabindex="-1" aria-labelledby="stcModalLabel" aria-hidden="true">
        <div class="modal-dialog" style="max-width: 350px;">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="stcModalLabel">
                        <i class="fas fa-plus-circle me-2"></i>
                        Add STC Trade
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="stcForm">
                        <div class="mb-3">
                            <label for="stc-account" class="form-label">Account</label>
                            <select class="form-select" id="stc-account" name="accountId" required>
                                <option value="">Loading accounts...</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="stc-trade-date" class="form-label">Trade Date</label>
                            <input type="text" class="form-control" id="stc-trade-date" name="tradeDate" placeholder="DD-MMM-YY" data-display-format="DD-MMM-YY" data-edit-format="MM/DD/YY" onfocus="handleDateInputFocus(this)" onblur="handleDateInputBlur(this)" required>
                        </div>
                        <div class="mb-3">
                            <label for="stc-underlying" class="form-label">Underlying</label>
                            <div style="position: relative;">
                                <input type="text" class="form-control" id="stc-underlying" name="underlying" placeholder="Type ticker or company name..." autocomplete="off" required>
                                <div id="stc-underlying-suggestions" class="dropdown-menu" style="display: none;"></div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="stc-sale-price" class="form-label">Sale Price</label>
                            <div class="input-group">
                                <span class="input-group-text">$</span>
                                <input type="number" class="form-control" id="stc-sale-price" name="salePrice" step="0.01" placeholder="0.00" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="stc-shares" class="form-label">Number of Shares</label>
                            <input type="number" class="form-control" id="stc-shares" name="shares" min="1" placeholder="1" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer d-flex flex-column">
                    <div class="d-flex w-100 mb-2" id="stc-add-buttons">
                        <button type="button" class="btn btn-primary flex-fill me-2" onclick="submitSTCForm('addAndClose')">
                            <i class="fas fa-save me-2"></i>
                            Add and Close
                        </button>
                        <button type="button" class="btn btn-success flex-fill" onclick="submitSTCForm('addAnother')">
                            <i class="fas fa-plus me-2"></i>
                            Add Another
                        </button>
                    </div>
                    <div class="d-flex justify-content-center w-100 mb-2" id="stc-add-cancel">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <i class="fas fa-times me-2"></i>
                            Cancel
                        </button>
                    </div>
                    <div class="d-flex w-100 mb-2" id="stc-edit-buttons" style="display: none !important;">
                        <button type="button" class="btn btn-primary flex-fill me-2" onclick="submitSTCForm('save')">
                            <i class="fas fa-save me-2"></i>
                            Save
                        </button>
                        <button type="button" class="btn btn-secondary flex-fill" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ROCT PUT Modal -->
    <div class="modal fade" id="roctPutModal" tabindex="-1" aria-labelledby="roctPutModalLabel" aria-hidden="true">
        <div class="modal-dialog" style="max-width: 350px;">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="roctPutModalLabel">
                        <i class="fas fa-plus-circle me-2"></i>
                        Add ROCT PUT Trade
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="roctPutForm">
                        <div class="mb-3">
                            <label for="roct-put-account" class="form-label">Account</label>
                            <select class="form-select" id="roct-put-account" name="accountId" required>
                                <option value="">Loading accounts...</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="roct-put-trade-date" class="form-label">Trade Date</label>
                            <input type="text" class="form-control" id="roct-put-trade-date" name="tradeDate" placeholder="DD-MMM-YY" data-display-format="DD-MMM-YY" data-edit-format="MM/DD/YY" onfocus="handleDateInputFocus(this)" onblur="handleDateInputBlur(this)" required>
                        </div>
                        <div class="mb-3">
                            <label for="roct-put-underlying" class="form-label">Underlying</label>
                            <div style="position: relative;">
                                <input type="text" class="form-control" id="roct-put-underlying" name="underlying" placeholder="Type ticker or company name..." autocomplete="off" required>
                                <div id="roct-put-underlying-suggestions" class="dropdown-menu" style="display: none;"></div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="roct-put-price" class="form-label">Price</label>
                            <div class="input-group">
                                <span class="input-group-text">$</span>
                                <input type="number" class="form-control" id="roct-put-price" name="price" step="0.01" placeholder="0.00" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="roct-put-expiration-date" class="form-label">Expiration Date</label>
                            <input type="text" class="form-control" id="roct-put-expiration-date" name="expirationDate" placeholder="DD-MMM-YY" data-display-format="DD-MMM-YY" data-edit-format="MM/DD/YY" onfocus="handleDateInputFocus(this)" onblur="handleDateInputBlur(this)" required>
                        </div>
                        <div class="mb-3">
                            <label for="roct-put-dte" class="form-label">DTE</label>
                            <input type="number" class="form-control" id="roct-put-dte" name="dte" readonly>
                        </div>
                        <div class="mb-3">
                            <label for="roct-put-strike-price" class="form-label">Strike Price</label>
                            <div class="input-group">
                                <span class="input-group-text">$</span>
                                <input type="number" class="form-control" id="roct-put-strike-price" name="strikePrice" step="0.01" placeholder="0.00" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="roct-put-credit-debit" class="form-label">Credit</label>
                            <div class="input-group">
                                <span class="input-group-text">$</span>
                                <input type="number" class="form-control" id="roct-put-credit-debit" name="creditDebit" step="0.01" placeholder="0.00" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="roct-put-quantity" class="form-label">Contracts</label>
                            <div class="input-group">
                                <input type="number" class="form-control" id="roct-put-quantity" name="num_of_contracts" min="1" placeholder="Number of contracts" required>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer d-flex flex-column">
                    <!-- Add Mode Buttons -->
                    <div class="d-flex w-100 mb-2" id="roct-put-add-buttons">
                        <button type="button" class="btn btn-primary flex-fill me-2" onclick="submitROCTPutForm('addAndClose')">
                            <i class="fas fa-save me-2"></i>
                            Add and Close
                        </button>
                        <button type="button" class="btn btn-success flex-fill" onclick="submitROCTPutForm('addAnother')">
                            <i class="fas fa-plus me-2"></i>
                            Add Another
                        </button>
                    </div>
                    <div class="d-flex justify-content-center w-100 mb-2" id="roct-put-add-cancel">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <i class="fas fa-times me-2"></i>
                            Cancel
                        </button>
                    </div>
                    <!-- Edit Mode Buttons -->
                    <div class="d-flex w-100 mb-2" id="roct-put-edit-buttons" style="display: none !important;">
                        <button type="button" class="btn btn-primary flex-fill me-2" onclick="submitROCTPutForm('save')">
                            <i class="fas fa-save me-2"></i>
                            Save
                        </button>
                        <button type="button" class="btn btn-secondary flex-fill" data-bs-dismiss="modal">
                            <i class="fas fa-times me-2"></i>
                            Cancel
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ROCT CALL Modal -->
    <div class="modal fade" id="roctCallModal" tabindex="-1" aria-labelledby="roctCallModalLabel" aria-hidden="true">
        <div class="modal-dialog" style="max-width: 350px;">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="roctCallModalLabel">
                        <i class="fas fa-plus-circle me-2"></i>
                        Add ROCT CALL Trade
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="roctCallForm">
                        <div class="mb-3">
                            <label for="roct-call-account" class="form-label">Account</label>
                            <select class="form-select" id="roct-call-account" name="accountId" required>
                                <option value="">Loading accounts...</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="roct-call-trade-date" class="form-label">Trade Date</label>
                            <input type="text" class="form-control" id="roct-call-trade-date" name="tradeDate" placeholder="DD-MMM-YY" data-display-format="DD-MMM-YY" data-edit-format="MM/DD/YY" onfocus="handleDateInputFocus(this)" onblur="handleDateInputBlur(this)" required>
                        </div>
                        <div class="mb-3">
                            <label for="roct-call-underlying" class="form-label">Underlying</label>
                            <div style="position: relative;">
                                <input type="text" class="form-control" id="roct-call-underlying" placeholder="Type ticker or company name..." autocomplete="off" required>
                                <div id="roct-call-underlying-suggestions" class="dropdown-menu" style="display: none;"></div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="roct-call-price" class="form-label">Price</label>
                            <div class="input-group">
                                <span class="input-group-text">$</span>
                                <input type="number" class="form-control" id="roct-call-price" step="0.01" placeholder="0.00" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="roct-call-expiration-date" class="form-label">Expiration Date</label>
                            <input type="text" class="form-control" id="roct-call-expiration-date" name="expirationDate" placeholder="DD-MMM-YY" data-display-format="DD-MMM-YY" data-edit-format="MM/DD/YY" onfocus="handleDateInputFocus(this)" onblur="handleDateInputBlur(this)" required>
                        </div>
                        <div class="mb-3">
                            <label for="roct-call-dte" class="form-label">DTE</label>
                            <input type="number" class="form-control" id="roct-call-dte" readonly>
                        </div>
                        <div class="mb-3">
                            <label for="roct-call-strike-price" class="form-label">Strike Price</label>
                            <div class="input-group">
                                <span class="input-group-text">$</span>
                                <input type="number" class="form-control" id="roct-call-strike-price" step="0.01" placeholder="0.00" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="roct-call-credit-debit" class="form-label">Credit</label>
                            <div class="input-group">
                                <span class="input-group-text">$</span>
                                <input type="number" class="form-control" id="roct-call-credit-debit" step="0.01" placeholder="0.00" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="roct-call-cost-basis" class="form-label">Cost Basis</label>
                            <div class="input-group">
                                <span class="input-group-text">$</span>
                                <input type="number" class="form-control" id="roct-call-cost-basis" step="0.01" placeholder="0.00" readonly>
                            </div>
                            <small class="form-text text-muted">Automatically loaded from cost basis table for selected symbol</small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer d-flex flex-column">
                    <div class="d-flex w-100 mb-2" id="roct-call-add-buttons">
                        <button type="button" class="btn btn-primary flex-fill me-2" onclick="submitROCTCallForm('addAndClose')">
                            <i class="fas fa-save me-2"></i>
                            Add and Close
                        </button>
                        <button type="button" class="btn btn-success flex-fill" onclick="submitROCTCallForm('addAnother')">
                            <i class="fas fa-plus me-2"></i>
                            Add Another
                        </button>
                    </div>
                    <div class="d-flex justify-content-center w-100 mb-2" id="roct-call-add-cancel">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <i class="fas fa-times me-2"></i>
                            Cancel
                        </button>
                    </div>
                    <!-- Edit Mode Buttons -->
                    <div class="d-flex w-100 mb-2" id="roct-call-edit-buttons" style="display: none !important;">
                        <button type="button" class="btn btn-primary flex-fill me-2" onclick="submitROCTCallForm('save')">
                            <i class="fas fa-save me-2"></i>
                            Save
                        </button>
                        <button type="button" class="btn btn-secondary flex-fill" data-bs-dismiss="modal">
                            <i class="fas fa-times me-2"></i>
                            Cancel
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Alert Container -->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}?v=372"></script>
    
    <script>
        // Global variable to track current section
        let currentSection = 'dashboard';
        let isManualNavigation = false;
        
        // Floating navigation scroll function
        function scrollToSection(sectionId) {
            const element = document.getElementById(sectionId);
            if (element) {
                isManualNavigation = true;
                
                // Dynamically calculate the sticky banner wrapper height
                const bannerWrapper = document.querySelector('.header-banner-wrapper');
                const bannerHeight = bannerWrapper ? bannerWrapper.offsetHeight : 150;
                
                const elementPosition = element.getBoundingClientRect().top + window.pageYOffset;
                const offsetPosition = elementPosition - bannerHeight;
                
                window.scrollTo({
                    top: offsetPosition,
                    behavior: 'smooth'
                });
            }
            
            // Update global currentSection variable
            const sections = ['dashboard', 'trades', 'cost-basis'];
            const sectionIndex = sections.indexOf(sectionId);
            
            // Update active nav item immediately
            document.querySelectorAll('.nav-item').forEach((item, index) => {
                item.classList.remove('active');
                if (index === sectionIndex) {
                    item.classList.add('active');
                }
            });
            
            // Update global variable
            currentSection = sectionId;
            
            // Reset flag after a delay to allow smooth scroll to complete
            setTimeout(() => {
                isManualNavigation = false;
            }, 1000);
        }
        
        // Debug function to check section widths
        function logSectionWidths() {
            const dashboard = document.getElementById('dashboard');
            const trades = document.getElementById('trades');
            const costBasis = document.getElementById('cost-basis');
            
            console.log('Dashboard width:', dashboard ? dashboard.offsetWidth : 'N/A');
            console.log('Trades width:', trades ? trades.offsetWidth : 'N/A');
            console.log('Cost Basis width:', costBasis ? costBasis.offsetWidth : 'N/A');
        }
        
        // Log widths when DOM is loaded
        window.addEventListener('load', function() {
            setTimeout(logSectionWidths, 1000);
            
            // Make floating nav draggable
            makeFloatingNavDraggable();
        });
        
        // Make floating nav draggable
        function makeFloatingNavDraggable() {
            const nav = document.getElementById('floatingNav');
            let isDragging = false;
            let currentX;
            let currentY;
            let initialX;
            let initialY;
            let xOffset = 0;
            let yOffset = 0;
            
            nav.addEventListener('mousedown', dragStart);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', dragEnd);
            
            function dragStart(e) {
                // Don't drag if clicking on nav items (but allow dragging from handle)
                if (e.target.closest('.nav-item')) {
                    return;
                }
                
                // Allow dragging from handle or nav background
                if (e.target.closest('.drag-handle') || e.target === nav || (nav.contains(e.target) && !e.target.closest('.nav-item'))) {
                    initialX = e.clientX - xOffset;
                    initialY = e.clientY - yOffset;
                    isDragging = true;
                }
            }
            
            function drag(e) {
                if (isDragging) {
                    e.preventDefault();
                    currentX = e.clientX - initialX;
                    currentY = e.clientY - initialY;
                    
                    xOffset = currentX;
                    yOffset = currentY;
                    
                    setTranslate(currentX, currentY, nav);
                }
            }
            
            function dragEnd(e) {
                initialX = currentX;
                initialY = currentY;
                isDragging = false;
            }
            
            function setTranslate(xPos, yPos, el) {
                el.style.left = xPos + 'px';
                el.style.top = yPos + 'px';
            }
        }
        
        // Update active nav item based on scroll position
        let lastScrollY = 0;
        
        window.addEventListener('scroll', function() {
            // Don't override manual navigation until it completes
            if (isManualNavigation) {
                return;
            }
            
            const sections = ['dashboard', 'trades', 'cost-basis'];
            const navItems = document.querySelectorAll('.nav-item');
            
            const scrollPosition = window.scrollY;
            const scrollDirection = scrollPosition > lastScrollY ? 'down' : 'up';
            lastScrollY = scrollPosition;
            
            let foundSection = '';
            const viewportCenter = scrollPosition + window.innerHeight / 2;
            
            // Simple approach: check each section from bottom to top
            for (let i = sections.length - 1; i >= 0; i--) {
                const sectionId = sections[i];
                const element = document.getElementById(sectionId);
                
                if (element) {
                    const rect = element.getBoundingClientRect();
                    const sectionTop = rect.top + scrollPosition;
                    const sectionBottom = sectionTop + element.offsetHeight;
                    
                    // If viewport center is within this section's bounds
                    if (viewportCenter >= sectionTop && viewportCenter < sectionBottom) {
                        foundSection = sectionId;
                        break;
                    }
                }
            }
            
            // Update currentSection
            if (foundSection) {
                currentSection = foundSection;
            }
            
            // Update active nav item
            navItems.forEach((item, index) => {
                item.classList.remove('active');
                if (sections[index] === currentSection) {
                    item.classList.add('active');
                }
            });
        });
    </script>
</body>
</html>

