<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Options Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}?v=164">
    <style>
        /* Remove grey background from $ symbol in input groups */
        .input-group-text {
            background-color: transparent !important;
            border-right: none !important;
            padding-right: 0.25rem !important;
        }
        
        .input-group .input-group-text + .form-control {
            border-left: none !important;
            text-align: center !important;
        }
        
        /* Center all input fields in trade forms */
        .modal-body form input[type="text"],
        .modal-body form input[type="number"],
        .modal-body form select {
            text-align: center !important;
        }
        
        /* Ensure all labels have the same width so inputs align at the same position */
        .modal-body form .mb-2 > .form-label {
            width: 130px !important;
            min-width: 130px !important;
            max-width: 130px !important;
        }
        
        /* Remove spinner arrows from number inputs in price, strike price, credit, and contracts fields */
        .input-group input[type="number"]::-webkit-inner-spin-button,
        .input-group input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        .input-group input[type="number"],
        input[type="number"] {
            -moz-appearance: textfield;
        }
        
        .sticky-control-bar {
            position: sticky;
            top: 63px; /* Reduced from 90px (30% reduction) - Position right below condensed sticky banner */
            z-index: 98; /* Below banner (z-index: 999) but above content */
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 0.7rem; /* Reduced from 1rem (30% reduction) */
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            margin-top: -1.05rem; /* Reduced from -1.5rem (30% reduction) - Pull up to fill gap */
            margin-bottom: 1.05rem; /* Reduced from 1.5rem (30% reduction) */
        }
        
        /* Date range button styling - remove outline on click and add selected state */
        .date-range-btn {
            outline: none !important;
            box-shadow: none !important;
            border: 1px solid rgba(255, 255, 255, 0.3) !important;
            font-size: 0.6125rem !important; /* Match condensed layout */
            padding: 0.175rem 0.35rem !important; /* Match condensed layout */
        }
        
        .date-range-btn:focus,
        .date-range-btn:active {
            outline: none !important;
            box-shadow: none !important;
        }
        
        .date-range-btn.selected {
            background-color: white !important;
            color: black !important;
            font-weight: bold !important;
            border-color: white !important;
        }
        
        .date-range-btn:not(.selected) {
            background-color: rgba(255, 255, 255, 0.2) !important;
            color: white !important;
        }
        
        /* Add a pseudo-element to fill the transparent gap */
        .sticky-control-bar::before {
            content: '';
            position: absolute;
            top: -1.05rem; /* Reduced from -1.5rem (30% reduction) */
            left: 0;
            right: 0;
            height: 1.05rem; /* Reduced from 1.5rem (30% reduction) */
            background-color: #f5f7fa; /* Match page background */
            z-index: -1;
        }
        
        .control-bar-content {
            display: flex;
            flex-wrap: wrap;
            gap: 0.7rem; /* Reduced from 1rem (30% reduction) */
            align-items: center;
            justify-content: center;
        }
        
        .control-group {
            display: flex;
            align-items: center;
            gap: 0.35rem; /* Reduced from 0.5rem (30% reduction) */
        }
        
        .control-group label {
            color: white;
            font-weight: 500;
            font-size: 0.6125rem; /* Reduced from 0.875rem (30% reduction) */
            white-space: nowrap;
        }
        
        .quick-add-buttons {
            display: flex;
            gap: 0.175rem; /* Reduced from 0.25rem (30% reduction) */
            flex-wrap: wrap;
        }
        
        .quick-add-btn {
            font-size: 0.525rem; /* Reduced from 0.75rem (30% reduction) */
            padding: 0.175rem 0.35rem; /* Reduced from 0.25rem 0.5rem (30% reduction) */
        }
        
        /* Flex container for trades and cost basis */
        .trades-cost-container {
            display: flex !important;
            flex-wrap: nowrap !important;
            width: 100% !important;
            align-items: flex-start !important;
        }
        
        .transition-width {
            transition: width 0.3s ease-in-out;
        }
        
        /* Trades column - horizontally collapsible */
        #trades-column {
            flex-shrink: 0;
            transition: width 0.3s ease-in-out, flex 0.3s ease-in-out;
            min-width: 0;
        }
        
        #trades-column.collapse:not(.show) {
            width: 0 !important;
            min-width: 0 !important;
            padding: 0 !important;
            margin: 0 !important;
            overflow: hidden !important;
            flex: 0 0 0 !important;
        }
        
        /* Widths will be managed by JavaScript updateColumnWidths() */
        /* CSS only handles the collapse state */
        
        /* Cost basis column - horizontally collapsible */
        #cost-basis-column {
            flex-shrink: 0;
            transition: width 0.3s ease-in-out, flex 0.3s ease-in-out;
            min-width: 0;
        }
        
        #cost-basis-column.collapse:not(.show) {
            width: 0 !important;
            min-width: 0 !important;
            padding: 0 !important;
            margin: 0 !important;
            overflow: hidden !important;
            flex: 0 0 0 !important;
        }
        
        #cost-basis-column.show {
            overflow: visible;
        }
        
        #trades-column .table-responsive {
            overflow-x: auto;
            max-width: 100%;
        }
        
        /* Make trades-cost-container position relative for absolute positioning of toggles */
        .trades-cost-container {
            position: relative;
        }
        /* Dropdown submenu styling */
        .dropdown-submenu {
            position: relative;
        }
        
        .dropdown-submenu .dropdown-menu {
            top: 0;
            right: 100%;
            left: auto;
            margin-top: -1px;
            margin-right: 0;
            display: none;
            padding: 0;
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
        }
        
        /* Keep submenu open when hovering over parent item or submenu itself */
        .dropdown-submenu:hover > .dropdown-menu,
        .dropdown-submenu.show > .dropdown-menu,
        .dropdown-submenu .dropdown-menu:hover {
            display: block !important;
        }
        
        /* Ensure the submenu item itself maintains hover */
        .dropdown-submenu > .dropdown-item:hover + .dropdown-menu,
        .dropdown-submenu > .dropdown-item:hover ~ .dropdown-menu {
            display: block !important;
        }
        
        /* Add a small delay bridge to prevent accidental closing */
        .dropdown-submenu::after {
            content: '';
            position: absolute;
            top: 0;
            right: -5px;
            width: 5px;
            height: 100%;
            background: transparent;
            z-index: 1052;
        }
        
        .dropdown-submenu > .dropdown-toggle::after {
            transform: rotate(90deg);
            float: right;
            margin-top: 0.5rem;
        }
        
        /* Prevent parent dropdown from closing when clicking in submenu */
        .dropdown-submenu .dropdown-menu {
            pointer-events: auto;
        }
        
        #header-menu-dropdown {
            z-index: 1050;
        }
        
        #import-submenu {
            z-index: 1051;
            min-width: 250px;
        }
        
        /* Hamburger button styling */
        #header-menu-toggle {
            border: none !important;
            outline: none !important;
            box-shadow: none !important;
            width: 3rem;
            padding: 0.5rem;
        }
        
        #header-menu-toggle:focus,
        #header-menu-toggle:active,
        #header-menu-toggle:hover {
            border: none !important;
            outline: none !important;
            box-shadow: none !important;
        }
        
        /* Make all dropdown items show pointer cursor on hover */
        #header-menu-dropdown .dropdown-item {
            cursor: pointer;
        }
        
        #header-menu-dropdown .dropdown-item:hover {
            cursor: pointer;
            background-color: rgba(0, 0, 0, 0.05);
        }
        
        #header-menu-dropdown .dropdown-submenu > .dropdown-item:hover {
            cursor: pointer;
            background-color: rgba(0, 0, 0, 0.05);
        }
        
        /* Ensure both import type buttons are always visible and same size */
        #import-submenu .btn-group {
            display: flex !important;
            gap: 0.5rem !important;
        }
        
        #import-submenu .btn-group label {
            display: block !important;
            flex: 1 1 auto;
            width: 50% !important;
            min-width: 50% !important;
            max-width: 50% !important;
            padding: 0.25rem 0.5rem !important;
            text-align: center !important;
            border-radius: 0.375rem !important;
        }
        
        /* Ensure first button (Trades) has rounded corners on left */
        #import-submenu .btn-group label[for="import-type-trades"] {
            border-radius: 0.375rem !important;
        }
        
        /* Ensure second button (Cost Basis) has rounded corners on right */
        #import-submenu .btn-group label[for="import-type-cost-basis"] {
            border-radius: 0.375rem !important;
        }
        
        /* Ensure Trades and Cost Basis buttons are visually distinct when selected */
        #import-type-trades:checked + label[for="import-type-trades"],
        #import-type-cost-basis:checked + label[for="import-type-cost-basis"] {
            background-color: #0d6efd !important;
            border-color: #0d6efd !important;
            color: white !important;
            font-weight: 600;
        }
        
        /* Unselected state - make it clear both are visible */
        #import-type-trades:not(:checked) + label[for="import-type-trades"],
        #import-type-cost-basis:not(:checked) + label[for="import-type-cost-basis"] {
            background-color: transparent !important;
            border-color: #0d6efd !important;
            color: #0d6efd !important;
        }
        
        #import-type-trades:checked + label[for="import-type-trades"]:active,
        #import-type-cost-basis:checked + label[for="import-type-cost-basis"]:active {
            background-color: #0a58ca !important;
            border-color: #0a58ca !important;
        }
        
        /* Hover state for unselected buttons */
        #import-type-trades:not(:checked) + label[for="import-type-trades"]:hover,
        #import-type-cost-basis:not(:checked) + label[for="import-type-cost-basis"]:hover {
            background-color: rgba(13, 110, 253, 0.1) !important;
        }
        
        /* Cost basis ticker card - fixed width of 42px (condensed layout) */
        .cost-basis-ticker-card {
            width: 42px !important;
            min-width: 42px !important;
            max-width: 42px !important;
            height: 56px !important;
            overflow: hidden !important;
        }
        
        .cost-basis-ticker-card .card-body {
            overflow: hidden !important;
            padding: 0.35rem !important; /* Reduced from 0.5rem (30% reduction) */
            height: 100% !important;
            display: flex !important;
            flex-direction: column !important;
            justify-content: center !important;
            align-items: center !important;
        }
        
        .cost-basis-ticker-card .card-body h6 {
            white-space: nowrap !important;
            overflow: hidden !important;
            text-overflow: ellipsis !important;
            margin: 0 !important;
            padding: 0 !important;
            width: 100% !important;
            display: block !important;
            text-align: center !important;
            font-size: 0.6125rem !important; /* Match condensed layout */
        }
    </style>
</head>
<body>

    <div class="page-wrapper">
        <!-- Header Banner -->
        <div class="header-banner-wrapper">
            <div class="header-banner d-flex justify-content-center align-items-center position-relative compact">
                <h1 class="text-center mb-0">
                    ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ Tracker
                </h1>
                <div class="position-absolute" style="right: 20px; top: 50%; transform: translateY(-50%);">
                    <button class="btn btn-link text-white p-0" type="button" id="header-menu-toggle" data-bs-toggle="dropdown" aria-expanded="false" style="cursor: pointer; font-size: 1.575rem; text-decoration: none; border: none; outline: none; width: 2.1rem; padding: 0.35rem;">
                        <i class="fas fa-bars"></i>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end" id="header-menu-dropdown" style="min-width: 250px;">
                        <li class="dropdown-item-text fw-bold">Menu</li>
                        <li><hr class="dropdown-divider"></li>
                        <li class="dropdown-item" onclick="toggleAccountsSettings()">
                            <i class="fas fa-building me-2"></i>Accounts
                        </li>
                        <li class="dropdown-item" onclick="toggleBankrollSettings()">
                            <i class="fas fa-wallet me-2"></i>Bankroll
                        </li>
                        <li class="dropdown-item" onclick="toggleCommissionSettings()">
                            <i class="fas fa-percent me-2"></i>Commissions
                        </li>
                        <li class="dropdown-submenu">
                            <a class="dropdown-item dropdown-toggle" href="#" role="button" id="import-submenu-toggle">
                                <i class="fas fa-file-excel me-2"></i>Import
                            </a>
                            <ul class="dropdown-menu" id="import-submenu">
                                <li class="px-3 py-2">
                                    <label class="form-label small mb-1">Account:</label>
                                    <select class="form-select form-select-sm" id="import-account-select">
                                        <option value="">Loading accounts...</option>
                                    </select>
                                </li>
                                <li class="px-3 py-2">
                                    <label class="form-label small mb-1">Type:</label>
                                    <div class="btn-group w-100" role="group" style="gap: 0.5rem;">
                                        <input type="radio" class="btn-check" name="import-type" id="import-type-trades" value="trades">
                                        <label class="btn btn-outline-primary btn-sm" for="import-type-trades" style="border-radius: 0.375rem !important;">Trades</label>
                                        <input type="radio" class="btn-check" name="import-type" id="import-type-cost-basis" value="cost-basis">
                                        <label class="btn btn-outline-primary btn-sm" for="import-type-cost-basis" style="border-radius: 0.375rem !important;">Cost Basis</label>
                                    </div>
                                </li>
                                <li class="px-3 py-2">
                                    <label class="form-label small mb-1">Import:</label>
                                    <label for="menu-excel-upload" class="btn btn-primary btn-sm w-100 mb-0" style="cursor: pointer;">
                                        <i class="fas fa-upload me-1"></i>Choose File
                                    </label>
                                    <input type="file" id="menu-excel-upload" name="file" accept=".xlsx,.xls,.xlsm" style="display: none;">
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- Sticky Control Bar -->
        <div class="sticky-control-bar">
            <div class="control-bar-content">
                <!-- Account Filter -->
                <div class="control-group">
                    <label for="universal-account-filter">Account:</label>
                    <select class="form-select form-select-sm" id="universal-account-filter" style="width: 105px; font-size: 0.6125rem; padding: 0.175rem 0.35rem;">
                        <option value="">All</option>
                    </select>
                </div>
                
                <!-- Quick Add Buttons -->
                <div class="control-group">
                    <label>Quick Add:</label>
                    <div class="quick-add-buttons">
                        <button class="btn btn-sm btn-light quick-add-btn" onclick="openBTOModal()">
                            <i class="fas fa-plus me-1"></i>BTO
                        </button>
                        <button class="btn btn-sm btn-light quick-add-btn" onclick="openROCTCallModal()">
                            <i class="fas fa-plus me-1"></i>ROC
                        </button>
                        <button class="btn btn-sm btn-light quick-add-btn" onclick="openROCTCallModal()">
                            <i class="fas fa-plus me-1"></i>ROCT CALL
                        </button>
                        <button class="btn btn-sm btn-light quick-add-btn" onclick="openROCTPutModal()">
                            <i class="fas fa-plus me-1"></i>ROCT PUT
                        </button>
                        <button class="btn btn-sm btn-light quick-add-btn" onclick="openROCTPutModal()">
                            <i class="fas fa-plus me-1"></i>ROP
                        </button>
                        <button class="btn btn-sm btn-light quick-add-btn" onclick="openSTCModal()">
                            <i class="fas fa-plus me-1"></i>STC
                        </button>
                    </div>
                </div>
                
                <!-- Universal Ticker Filter -->
                <div class="control-group">
                    <label for="universal-ticker-filter">Symbol:</label>
                    <div style="position: relative;">
                        <input type="text" class="form-control form-control-sm" id="universal-ticker-filter" placeholder="Filter by ticker..." style="width: 105px; font-size: 0.6125rem; padding: 0.175rem 0.35rem;" autocomplete="off">
                        <div id="universal-ticker-suggestions" class="dropdown-menu" style="display: none;"></div>
                    </div>
                    <button id="clear-universal-ticker" class="btn btn-sm btn-light" onclick="clearUniversalTickerFilter()" style="display: none; font-size: 0.6125rem; padding: 0.175rem 0.35rem;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <!-- Date Filters -->
                <div class="control-group">
                    <label for="universal-start-date">Start:</label>
                    <input type="date" class="form-control form-control-sm" id="universal-start-date" style="width: 98px; font-size: 0.6125rem; padding: 0.175rem 0.35rem;">
                </div>
                <div class="control-group">
                    <label for="universal-end-date">End:</label>
                    <input type="date" class="form-control form-control-sm" id="universal-end-date" style="width: 98px; font-size: 0.6125rem; padding: 0.175rem 0.35rem;">
                </div>
                
                <!-- Quick Date Buttons -->
                <div class="control-group">
                    <div class="btn-group btn-group-sm" id="universal-date-range-buttons">
                        <button class="btn btn-light date-range-btn" data-period="week" onclick="setUniversalDateRange('week')">1W</button>
                        <button class="btn btn-light date-range-btn" data-period="month" onclick="setUniversalDateRange('month')">1M</button>
                        <button class="btn btn-light date-range-btn" data-period="year" onclick="setUniversalDateRange('year')">1Y</button>
                        <button class="btn btn-light date-range-btn" data-period="ytd" onclick="setUniversalDateRange('ytd')">YTD</button>
                        <button class="btn btn-light date-range-btn" data-period="clear" onclick="clearUniversalDateFilters()">Clear</button>
                    </div>
                </div>
                
            </div>
        </div>
        
        <!-- Commission Settings Modal -->
        <div id="commission-modal" class="modal fade" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Commission Settings</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="commission-account-select" class="form-label">Account:</label>
                            <select class="form-select form-select-sm" id="commission-account-select">
                                <option value="">Loading accounts...</option>
                            </select>
                        </div>
                        
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h6 class="mb-0">Commission History</h6>
                            <button type="button" class="btn btn-sm btn-primary" onclick="openNewCommissionForm()">
                                <i class="fas fa-plus me-1"></i>New Commission
                            </button>
                        </div>
                        
                        <div id="commissions-table-container" class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                            <table class="table table-sm table-striped">
                                <thead class="table-light sticky-top">
                                    <tr>
                                        <th>Effective Date</th>
                                        <th>Commission Rate ($)</th>
                                        <th>Notes</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="commissions-table-body">
                                    <tr>
                                        <td colspan="4" class="text-center text-muted">Loading commissions...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- New/Edit Commission Form (initially hidden) -->
                        <div id="commission-form-container" style="display: none; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #dee2e6;">
                            <h6 id="commission-form-title">New Commission</h6>
                            <form id="commission-form">
                                <input type="hidden" id="commission-edit-id" value="">
                                <div class="row">
                                    <div class="col-md-4 mb-3">
                                        <label for="commission-rate-input" class="form-label">Commission Rate ($)</label>
                                        <input type="number" class="form-control form-control-sm" id="commission-rate-input" step="0.00001" min="0" max="999.99999" required>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label for="commission-effective-date-input" class="form-label">Effective Date</label>
                                        <input type="date" class="form-control form-control-sm" id="commission-effective-date-input" required>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label for="commission-notes-input" class="form-label">Notes (optional)</label>
                                        <input type="text" class="form-control form-control-sm" id="commission-notes-input">
                                    </div>
                                </div>
                                <div class="d-flex gap-2">
                                    <button type="submit" class="btn btn-sm btn-primary" id="commission-save-btn">Save</button>
                                    <button type="button" class="btn btn-sm btn-secondary" onclick="cancelCommissionForm()">Cancel</button>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Accounts Settings Modal -->
        <div id="accounts-modal" class="modal fade" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Account Management</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h6 class="mb-0">Accounts</h6>
                            <button type="button" class="btn btn-sm btn-primary" onclick="openNewAccountForm()">
                                <i class="fas fa-plus me-1"></i>New Account
                            </button>
                        </div>
                        
                        <div id="accounts-table-container" class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                            <table class="table table-sm table-striped">
                                <thead class="table-light sticky-top">
                                    <tr>
                                        <th>Default</th>
                                        <th>Account Name</th>
                                        <th>Account Type</th>
                                        <th>Starting Balance</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="accounts-table-body">
                                    <tr>
                                        <td colspan="5" class="text-center text-muted">Loading accounts...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- New/Edit Account Form (initially hidden) -->
                        <div id="account-form-container" style="display: none; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #dee2e6;">
                            <h6 id="account-form-title">New Account</h6>
                            <form id="account-form">
                                <input type="hidden" id="account-edit-id" value="">
                                <div class="row">
                                    <div class="col-md-4 mb-3">
                                        <label for="account-name-input" class="form-label">Account Name</label>
                                        <input type="text" class="form-control form-control-sm" id="account-name-input" required>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label for="account-type-input" class="form-label">Account Type</label>
                                        <select class="form-select form-select-sm" id="account-type-input" required>
                                            <option value="PRIMARY">PRIMARY</option>
                                            <option value="INVESTMENT">INVESTMENT</option>
                                            <option value="TRADING">TRADING</option>
                                            <option value="RETIREMENT">RETIREMENT</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label for="account-starting-balance-input" class="form-label">Starting Balance</label>
                                        <input type="text" class="form-control form-control-sm" id="account-starting-balance-input" placeholder="$0.00" required>
                                    </div>
                                </div>
                                <div class="d-flex gap-2">
                                    <button type="submit" class="btn btn-sm btn-primary" id="account-save-btn">Save</button>
                                    <button type="button" class="btn btn-sm btn-secondary" onclick="cancelAccountForm()">Cancel</button>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dashboard Cards and Chart (Full Width) -->
        <div class="container-fluid px-0">
            <div class="row mb-5">
                <div class="col-12">
                    <div class="card section-card" id="dashboard" style="width: 100%;">
                    <div class="card-header bg-info text-white compact">
                        <div class="d-flex align-items-center justify-content-between">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-chevron-down section-toggle-icon" id="dashboardToggleIcon" data-bs-toggle="collapse" data-bs-target="#dashboardCollapse" aria-expanded="true" aria-controls="dashboardCollapse"></i>
                                <h5 class="mb-0 section-title" style="font-size: 1.3125rem; font-weight: bold;">
                                    <i class="fas fa-tachometer-alt me-2"></i>
                                    Dashboard
                                </h5>
                                <!-- Old dashboard controls hidden - now in universal control bar -->
                                <div class="d-flex align-items-center dashboard-controls" style="gap: 2px; display: none !important;">
                                    <div class="d-flex align-items-center">
                                        <label for="dashboard-start-date" class="form-label form-label-sm text-white me-1 mb-0">Start</label>
                                        <input type="date" class="form-control form-control-sm dashboard-date-input" id="dashboard-start-date">
                                    </div>
                                    <div class="d-flex align-items-center">
                                        <label for="dashboard-end-date" class="form-label form-label-sm text-white me-1 mb-0">End</label>
                                        <input type="date" class="form-control form-control-sm dashboard-date-input" id="dashboard-end-date">
                                    </div>
                                    <button class="btn btn-sm btn-outline-light" onclick="setDashboardPeriod('week')">1W</button>
                                    <button class="btn btn-sm btn-outline-light" onclick="setDashboardPeriod('month')">1M</button>
                                    <button class="btn btn-sm btn-outline-light" onclick="setDashboardPeriod('year')">1Y</button>
                                    <button class="btn btn-sm btn-outline-light" onclick="setDashboardPeriod('ytd')">YTD</button>
                                    <button class="btn btn-sm btn-outline-light" onclick="clearDashboardFilters()">Clear</button>
                                </div>
                            </div>
                        </div>
                    </div>
                <div class="collapse show" id="dashboardCollapse">
                    <div class="card-body">
                        <div class="dashboard-content-container">
                <!-- First Row -->
                <div class="row mt-3">
                    <div class="col-md-6">
                        <div class="card bg-info text-white shadow-sm mb-3">
                            <div class="card-body text-center">
                                <div class="d-flex align-items-center justify-content-center mb-2">
                                    <i class="fas fa-dollar-sign fa-2x me-2"></i>
                                    <h6 class="card-title mb-0">Financial</h6>
                                </div>
                                <div class="row text-center">
                                    <div class="col-4">
                                        <h6 class="mb-1">Net Credit</h6>
                                        <p class="card-text h5 mb-0" id="total-net-credit">$0.00</p>
                                    </div>
                                    <div class="col-4">
                                        <h6 class="mb-1">Days Left</h6>
                                        <p class="card-text h5 mb-0" id="days-remaining">0</p>
                                    </div>
                                    <div class="col-4">
                                        <h6 class="mb-1">Days Done</h6>
                                        <p class="card-text h5 mb-0" id="days-done">0</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card bg-success text-white shadow-sm">
                            <div class="card-body text-center">
                                <div class="d-flex align-items-center justify-content-center mb-2">
                                    <i class="fas fa-star fa-2x me-2"></i>
                                    <h6 class="card-title mb-0">Top Symbols</h6>
                                </div>
                                <div id="top-symbols-list" class="text-center">
                                    <div class="text-center text-muted">
                                        <small>Loading...</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                
                <!-- Chart Row - Doughnut Chart and Daily Premium Chart -->
                <div class="row mt-3">
                    <div class="col-6">
                        <div class="card">
                            <div class="card-body d-flex flex-column">
                                <div class="d-flex align-items-center justify-content-center mb-3">
                                    <i class="fas fa-chart-pie fa-2x text-primary me-2"></i>
                                    <h6 class="card-title mb-0 text-primary">Trade Statistics</h6>
                                </div>
                                <div class="d-flex flex-grow-1 chart-container">
                                    <div class="d-flex flex-column justify-content-center me-3 legend-container">
                                        <div class="d-flex align-items-center mb-2">
                                            <div class="me-2 legend-item" style="background-color: #28a745;"></div>
                                            <div>
                                                <div class="fw-bold legend-text">Open</div>
                                                <small class="text-muted legend-subtext" id="legend-open-count">0 (0%)</small>
                                            </div>
                                        </div>
                                        <div class="d-flex align-items-center mb-2">
                                            <div class="me-2 legend-item" style="background-color: #ffc107;"></div>
                                            <div>
                                                <div class="fw-bold legend-text">Completed</div>
                                                <small class="text-muted legend-subtext" id="legend-completed-count">0 (0%)</small>
                                            </div>
                                        </div>
                                        <div class="d-flex align-items-center mb-2" style="padding-left: 20px;">
                                            <div class="me-2 legend-item" style="background-color: #17a2b8;"></div>
                                            <div>
                                                <div class="fw-bold legend-text">Wins</div>
                                                <small class="text-muted legend-subtext" id="legend-wins-count">0 (0%)</small>
                                            </div>
                                        </div>
                                        <div class="d-flex align-items-center" style="padding-left: 20px;">
                                            <div class="me-2 legend-item" style="background-color: #dc3545;"></div>
                                            <div>
                                                <div class="fw-bold legend-text">Losses</div>
                                                <small class="text-muted legend-subtext" id="legend-losses-count">0 (0%)</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="position-relative flex-grow-1 d-flex justify-content-center align-items-center">
                                        <div id="sunburst-chart" class="sunburst-chart"></div>
                                        <div class="position-absolute top-50 start-50 translate-middle text-center">
                                            <div class="h4 mb-0 text-primary" id="total-trades-center">0</div>
                                            <small class="text-muted">Total Trades</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="card">
                            <div class="card-body d-flex flex-column">
                                <div class="d-flex align-items-center justify-content-center mb-3">
                                    <i class="fas fa-wallet fa-2x text-success me-2"></i>
                                    <h6 class="card-title mb-0 text-success">Bankroll Allocation</h6>
                                </div>
                                <div class="d-flex flex-grow-1 flex-column justify-content-center">
                                    <div class="d-flex chart-container justify-content-center align-items-center mb-3">
                                        <div id="bankroll-chart" class="sunburst-chart"></div>
                                        <div class="ms-3 d-flex flex-column justify-content-center">
                                            <div class="d-flex align-items-center mb-2">
                                                <div class="me-2" style="width: 12px; height: 12px; background-color: #dc3545; border-radius: 50%;"></div>
                                                <div>
                                                    <div class="fw-bold">Used</div>
                                                    <small class="text-muted" id="bankroll-in-use">$0</small>
                                                </div>
                                            </div>
                                            <div class="d-flex align-items-center mb-2">
                                                <div class="me-2" style="width: 12px; height: 12px; background-color: #28a745; border-radius: 50%;"></div>
                                                <div>
                                                    <div class="fw-bold">Available</div>
                                                    <small class="text-muted" id="bankroll-available">$0</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-muted small mb-1">Total Bankroll</div>
                                        <div class="h4 mb-0 fw-bold" id="bankroll-total-display">$0</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Premium Chart Row -->
                <div class="row mt-3">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <h6 class="card-title">
                                    <i class="fas fa-chart-area text-primary me-2"></i>
                                    Daily Premium Over Time
                                </h6>
                                <div class="chart-container">
                                    <canvas id="premiumChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                        </div>
                    </div>
                </div>
                </div>
            </div>
        </div>
        </div>

        <!-- Collapsed Sections Toggle Card (shown when both sections are collapsed) -->
        <div class="container-fluid px-0" id="collapsed-sections-card" style="display: none; margin-top: 2.25rem;">
            <div class="card section-card">
                <div class="card-header bg-success text-white compact">
                    <h5 class="mb-0 section-title" style="font-size: 1.875rem; font-weight: bold;">
                        <i class="fas fa-bars me-2"></i>
                        Expand Sections
                    </h5>
                </div>
                <div class="card-body d-flex justify-content-between align-items-center" style="min-height: 80px;">
                    <button class="btn btn-lg btn-success" id="trades-collapsed-card-toggle" onclick="toggleTrades()">
                        <i class="fas fa-chevron-right me-2" id="trades-collapsed-card-icon"></i>
                        Trades
                    </button>
                    <button class="btn btn-lg btn-success" id="cost-basis-collapsed-card-toggle" onclick="toggleCostBasis()">
                        <i class="fas fa-chevron-left me-2" id="cost-basis-collapsed-card-icon"></i>
                        Cost Basis
                    </button>
                </div>
            </div>
        </div>

        <!-- Trades and Cost Basis Section -->
        <div class="container-fluid px-0">
            <div class="trades-cost-container mb-5" style="margin-top: 2.25rem;">
                <!-- Trades Card (on the left, horizontally collapsible) -->
                <div id="trades-column" class="collapse show flex-shrink-0 transition-width me-3">
                    <div class="card section-card" id="trades" style="width: 100%;">
                    <div class="card-header bg-success text-white compact d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                            <button class="btn btn-sm btn-light me-3" id="trades-toggle-btn" onclick="toggleTrades()">
                                <i class="fas fa-chevron-left" id="trades-toggle-icon"></i>
                            </button>
                            <h5 class="mb-0 section-title" style="font-size: 1.3125rem; font-weight: bold;">
                                <i class="fas fa-chart-line me-2"></i>
                                Trades
                            </h5>
                            <!-- Status Filter -->
                            <div class="d-flex align-items-center ms-3" style="gap: 1px;">
                                <label for="status-filter" class="form-label mb-0 me-1 text-white">Status:</label>
                                <select class="form-select form-select-sm status-filter" id="status-filter" style="width: 90px;">
                                    <option value="">All</option>
                                    <option value="assigned">Assigned</option>
                                    <option value="closed">Closed</option>
                                    <option value="expired">Expired</option>
                                    <option value="open">Open</option>
                                    <option value="roll">Roll</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="dashboard-content-container">
                            <div class="row">
                                <!-- Trades Table -->
                                <div class="col-12">
                                    <div class="table-responsive">
                                        <table class="table table-sm table-fixed" id="trades-table-main">
                                            <tbody id="trades-table"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    </div>
                </div>
                
                <!-- Cost Basis Card (on the right, collapsible) -->
                <div id="cost-basis-column" class="collapse show flex-shrink-0 transition-width">
                    <div class="card section-card" style="width: 100%;">
                        <div class="card-header bg-success text-white compact d-flex justify-content-between align-items-center">
                            <div class="d-flex align-items-center">
                                <div style="width: 2.5rem; margin-right: 1rem;"></div>
                                <h5 class="mb-0 section-title" style="font-size: 1.3125rem; font-weight: bold;">
                                    <i class="fas fa-calculator me-2"></i>
                                    Cost Basis
                                </h5>
                            </div>
                            <button class="btn btn-sm btn-light" id="cost-basis-toggle-btn" onclick="toggleCostBasis()">
                                <i class="fas fa-chevron-right" id="cost-basis-toggle-icon"></i>
                            </button>
                        </div>
                        <div class="card-body" id="cost-basis-inline-container">
                            <!-- Cost basis content will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>

    <!-- BTO Form Modal -->
    <div class="modal fade" id="btoModal" tabindex="-1" aria-labelledby="btoModalLabel" aria-hidden="true">
        <div class="modal-dialog" style="max-width: 350px;">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="btoModalLabel">
                        <i class="fas fa-plus-circle me-2"></i>
                        Add BTO Trade
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="btoForm">
                        <div class="mb-2 d-flex align-items-center">
                            <label for="bto-account" class="form-label me-2" style="margin-bottom: 0;">Account</label>
                            <select class="form-select form-select-sm" id="bto-account" name="accountId" style="width: 100px;" required>
                                <option value="">Loading accounts...</option>
                            </select>
                        </div>
                        <div class="mb-2 d-flex align-items-center">
                            <label for="bto-underlying" class="form-label me-2" style="margin-bottom: 0;">Underlying</label>
                            <div style="position: relative;">
                                <input type="text" class="form-control form-control-sm" id="bto-underlying" name="underlying" placeholder="Type ticker or company name..." autocomplete="off" style="width: 100px;" oninput="convertToUppercase(this)" onblur="convertToUppercase(this)" required>
                                <div id="bto-underlying-suggestions" class="dropdown-menu" style="display: none;"></div>
                            </div>
                        </div>
                        <div class="mb-2 d-flex align-items-center">
                            <label for="bto-trade-date" class="form-label me-2" style="margin-bottom: 0;">Trade Date</label>
                            <input type="text" class="form-control form-control-sm" id="bto-trade-date" name="tradeDate" placeholder="DD-MMM-YY" data-display-format="DD-MMM-YY" data-edit-format="MM/DD/YY" onfocus="handleDateInputFocus(this)" onblur="handleDateInputBlur(this)" style="width: 100px;" required>
                        </div>
                        <div class="mb-2 d-flex align-items-center">
                            <label for="bto-purchase-price" class="form-label me-2" style="margin-bottom: 0;">Purchase Price</label>
                            <div class="input-group input-group-sm" style="width: 100px;">
                                <span class="input-group-text">$</span>
                                <input type="number" class="form-control" id="bto-purchase-price" name="purchasePrice" step="0.01" placeholder="0.00" onfocus="handleNumberInputFocus(this)" onblur="handleNumberInputBlur(this)" required>
                            </div>
                        </div>
                        <div class="mb-2 d-flex align-items-center">
                            <label for="bto-shares" class="form-label me-2" style="margin-bottom: 0;">Number of Shares</label>
                            <input type="number" class="form-control form-control-sm" id="bto-shares" name="shares" min="1" placeholder="1" style="width: 100px;" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer d-flex flex-column">
                    <div class="d-flex w-100 mb-2" id="bto-add-buttons">
                        <button type="button" class="btn btn-primary flex-fill me-2" onclick="submitBTOForm('addAndClose')">
                            <i class="fas fa-save me-2"></i>
                            Add and Close
                        </button>
                        <button type="button" class="btn btn-success flex-fill" onclick="submitBTOForm('addAnother')">
                            <i class="fas fa-plus me-2"></i>
                            Add Another
                        </button>
                    </div>
                    <div class="d-flex justify-content-center w-100 mb-2" id="bto-add-cancel">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <i class="fas fa-times me-2"></i>
                            Cancel
                        </button>
                    </div>
                    <div class="d-flex w-100 mb-2" id="bto-edit-buttons" style="display: none !important;">
                        <button type="button" class="btn btn-primary flex-fill me-2" onclick="submitBTOForm('save')">
                            <i class="fas fa-save me-2"></i>
                            Save
                        </button>
                        <button type="button" class="btn btn-secondary flex-fill" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- STC Modal -->
    <div class="modal fade" id="stcModal" tabindex="-1" aria-labelledby="stcModalLabel" aria-hidden="true">
        <div class="modal-dialog" style="max-width: 350px;">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="stcModalLabel">
                        <i class="fas fa-plus-circle me-2"></i>
                        Add STC Trade
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="stcForm">
                        <div class="mb-2 d-flex align-items-center">
                            <label for="stc-account" class="form-label me-2" style="margin-bottom: 0;">Account</label>
                            <select class="form-select form-select-sm" id="stc-account" name="accountId" style="width: 100px;" required>
                                <option value="">Loading accounts...</option>
                            </select>
                        </div>
                        <div class="mb-2 d-flex align-items-center">
                            <label for="stc-underlying" class="form-label me-2" style="margin-bottom: 0;">Underlying</label>
                            <div style="position: relative;">
                                <input type="text" class="form-control form-control-sm" id="stc-underlying" name="underlying" placeholder="Type ticker or company name..." autocomplete="off" style="width: 100px;" oninput="convertToUppercase(this)" onblur="convertToUppercase(this)" required>
                                <div id="stc-underlying-suggestions" class="dropdown-menu" style="display: none;"></div>
                            </div>
                        </div>
                        <div class="mb-2 d-flex align-items-center">
                            <label for="stc-trade-date" class="form-label me-2" style="margin-bottom: 0;">Trade Date</label>
                            <input type="text" class="form-control form-control-sm" id="stc-trade-date" name="tradeDate" placeholder="DD-MMM-YY" data-display-format="DD-MMM-YY" data-edit-format="MM/DD/YY" onfocus="handleDateInputFocus(this)" onblur="handleDateInputBlur(this)" style="width: 100px;" required>
                        </div>
                        <div class="mb-2 d-flex align-items-center">
                            <label for="stc-sale-price" class="form-label me-2" style="margin-bottom: 0;">Sale Price</label>
                            <div class="input-group input-group-sm" style="width: 100px;">
                                <span class="input-group-text">$</span>
                                <input type="number" class="form-control" id="stc-sale-price" name="salePrice" step="0.01" placeholder="0.00" onfocus="handleNumberInputFocus(this)" onblur="handleNumberInputBlur(this)" required>
                            </div>
                        </div>
                        <div class="mb-2 d-flex align-items-center">
                            <label for="stc-shares" class="form-label me-2" style="margin-bottom: 0;">Number of Shares</label>
                            <input type="number" class="form-control form-control-sm" id="stc-shares" name="shares" min="1" placeholder="1" style="width: 100px;" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer d-flex flex-column">
                    <div class="d-flex w-100 mb-2" id="stc-add-buttons">
                        <button type="button" class="btn btn-primary flex-fill me-2" onclick="submitSTCForm('addAndClose')">
                            <i class="fas fa-save me-2"></i>
                            Add and Close
                        </button>
                        <button type="button" class="btn btn-success flex-fill" onclick="submitSTCForm('addAnother')">
                            <i class="fas fa-plus me-2"></i>
                            Add Another
                        </button>
                    </div>
                    <div class="d-flex justify-content-center w-100 mb-2" id="stc-add-cancel">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <i class="fas fa-times me-2"></i>
                            Cancel
                        </button>
                    </div>
                    <div class="d-flex w-100 mb-2" id="stc-edit-buttons" style="display: none !important;">
                        <button type="button" class="btn btn-primary flex-fill me-2" onclick="submitSTCForm('save')">
                            <i class="fas fa-save me-2"></i>
                            Save
                        </button>
                        <button type="button" class="btn btn-secondary flex-fill" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ROCT PUT Modal -->
    <div class="modal fade" id="roctPutModal" tabindex="-1" aria-labelledby="roctPutModalLabel" aria-hidden="true">
        <div class="modal-dialog" style="max-width: 350px;">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="roctPutModalLabel">
                        <i class="fas fa-plus-circle me-2"></i>
                        Add ROCT PUT Trade
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="roctPutForm">
                        <div class="mb-2 d-flex align-items-center">
                            <label for="roct-put-account" class="form-label me-2" style="margin-bottom: 0;">Account</label>
                            <select class="form-select form-select-sm" id="roct-put-account" name="accountId" style="width: 100px;" required>
                                <option value="">Loading accounts...</option>
                            </select>
                        </div>
                        <div class="mb-2 d-flex align-items-center">
                            <label for="roct-put-underlying" class="form-label me-2" style="margin-bottom: 0;">Underlying</label>
                            <div style="position: relative;">
                                <input type="text" class="form-control form-control-sm" id="roct-put-underlying" name="underlying" placeholder="Type ticker or company name..." autocomplete="off" style="width: 100px;" oninput="convertToUppercase(this)" onblur="convertToUppercase(this)" required>
                                <div id="roct-put-underlying-suggestions" class="dropdown-menu" style="display: none;"></div>
                            </div>
                        </div>
                        <div class="mb-2 d-flex align-items-center">
                            <label for="roct-put-trade-date" class="form-label me-2" style="margin-bottom: 0;">Trade Date</label>
                            <input type="text" class="form-control form-control-sm" id="roct-put-trade-date" name="tradeDate" placeholder="DD-MMM-YY" data-display-format="DD-MMM-YY" data-edit-format="MM/DD/YY" onfocus="handleDateInputFocus(this)" onblur="handleDateInputBlur(this)" style="width: 100px;" required>
                        </div>
                        <div class="mb-2 d-flex align-items-center">
                            <label for="roct-put-price" class="form-label me-2" style="margin-bottom: 0;">Current Price</label>
                            <div class="input-group input-group-sm" style="width: 100px;">
                                <span class="input-group-text">$</span>
                                <input type="number" class="form-control" id="roct-put-price" name="price" step="0.01" placeholder="0.00" onfocus="handleNumberInputFocus(this)" onblur="handleNumberInputBlur(this)" required>
                            </div>
                        </div>
                        <div class="mb-2 d-flex align-items-center">
                            <label for="roct-put-expiration-date" class="form-label me-2" style="margin-bottom: 0;">Expiration Date</label>
                            <input type="text" class="form-control form-control-sm" id="roct-put-expiration-date" name="expirationDate" placeholder="DD-MMM-YY" data-display-format="DD-MMM-YY" data-edit-format="MM/DD/YY" onfocus="handleDateInputFocus(this)" onblur="handleDateInputBlur(this)" style="width: 100px;" required>
                        </div>
                        <div class="mb-2 d-flex align-items-center">
                            <label for="roct-put-dte" class="form-label me-2" style="margin-bottom: 0;">DTE</label>
                            <input type="number" class="form-control form-control-sm" id="roct-put-dte" name="dte" style="width: 100px;" readonly onchange="calculateROCTPutARORC()">
                        </div>
                        <div class="mb-2 d-flex align-items-center">
                            <label for="roct-put-strike-price" class="form-label me-2" style="margin-bottom: 0;">Strike Price</label>
                            <div class="input-group input-group-sm" style="width: 100px;">
                                <span class="input-group-text">$</span>
                                <input type="number" class="form-control" id="roct-put-strike-price" name="strikePrice" step="0.01" placeholder="0.00" onfocus="handleNumberInputFocus(this)" onblur="handleNumberInputBlur(this)" oninput="calculateROCTPutARORC()" required>
                            </div>
                        </div>
                        <div class="mb-2 d-flex align-items-center">
                            <label for="roct-put-credit-debit" class="form-label me-2" style="margin-bottom: 0;">Credit</label>
                            <div class="input-group input-group-sm" style="width: 100px;">
                                <span class="input-group-text">$</span>
                                <input type="number" class="form-control" id="roct-put-credit-debit" name="creditDebit" step="0.01" placeholder="0.00" onfocus="handleNumberInputFocus(this)" onblur="handleNumberInputBlur(this)" oninput="calculateROCTPutARORC()" required>
                            </div>
                        </div>
                        <div class="mb-2 d-flex align-items-center">
                            <label for="roct-put-arorc" class="form-label me-2" style="margin-bottom: 0;">ARORC</label>
                            <div class="input-group input-group-sm" style="width: 100px;">
                                <input type="number" class="form-control" id="roct-put-arorc" name="arorc" step="0.1" placeholder="0.0" readonly style="background-color: #e9ecef;">
                                <span class="input-group-text">%</span>
                            </div>
                        </div>
                        <div class="mb-2 d-flex align-items-center">
                            <label for="roct-put-quantity" class="form-label me-2" style="margin-bottom: 0;"># of Contracts</label>
                            <input type="number" class="form-control form-control-sm" id="roct-put-quantity" name="num_of_contracts" min="1" value="1" style="width: 100px;" onfocus="handleNumberInputFocus(this)" onblur="handleNumberInputBlur(this)" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer d-flex flex-column">
                    <!-- Add Mode Buttons -->
                    <div class="d-flex w-100 mb-2" id="roct-put-add-buttons">
                        <button type="button" class="btn btn-primary flex-fill me-2" onclick="submitROCTPutForm('addAndClose')">
                            <i class="fas fa-save me-2"></i>
                            Add and Close
                        </button>
                        <button type="button" class="btn btn-success flex-fill" onclick="submitROCTPutForm('addAnother')">
                            <i class="fas fa-plus me-2"></i>
                            Add Another
                        </button>
                    </div>
                    <div class="d-flex justify-content-center w-100 mb-2" id="roct-put-add-cancel">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <i class="fas fa-times me-2"></i>
                            Cancel
                        </button>
                    </div>
                    <!-- Edit Mode Buttons -->
                    <div class="d-flex w-100 mb-2" id="roct-put-edit-buttons" style="display: none !important;">
                        <button type="button" class="btn btn-primary flex-fill me-2" onclick="submitROCTPutForm('save')">
                            <i class="fas fa-save me-2"></i>
                            Save
                        </button>
                        <button type="button" class="btn btn-secondary flex-fill" data-bs-dismiss="modal">
                            <i class="fas fa-times me-2"></i>
                            Cancel
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ROCT CALL Modal -->
    <div class="modal fade" id="roctCallModal" tabindex="-1" aria-labelledby="roctCallModalLabel" aria-hidden="true">
        <div class="modal-dialog" style="max-width: 350px;">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="roctCallModalLabel">
                        <i class="fas fa-plus-circle me-2"></i>
                        Add ROCT CALL Trade
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="roctCallForm">
                        <div class="mb-2 d-flex align-items-center">
                            <label for="roct-call-account" class="form-label me-2" style="margin-bottom: 0;">Account</label>
                            <select class="form-select form-select-sm" id="roct-call-account" name="accountId" style="width: 100px;" required>
                                <option value="">Loading accounts...</option>
                            </select>
                        </div>
                        <div class="mb-2 d-flex align-items-center">
                            <label for="roct-call-underlying" class="form-label me-2" style="margin-bottom: 0;">Underlying</label>
                            <div style="position: relative;">
                                <input type="text" class="form-control form-control-sm" id="roct-call-underlying" placeholder="Type ticker or company name..." autocomplete="off" style="width: 100px;" oninput="convertToUppercase(this)" onblur="convertToUppercase(this)" required>
                                <div id="roct-call-underlying-suggestions" class="dropdown-menu" style="display: none;"></div>
                            </div>
                        </div>
                        <div class="mb-2 d-flex align-items-center">
                            <label for="roct-call-trade-date" class="form-label me-2" style="margin-bottom: 0;">Trade Date</label>
                            <input type="text" class="form-control form-control-sm" id="roct-call-trade-date" name="tradeDate" placeholder="DD-MMM-YY" data-display-format="DD-MMM-YY" data-edit-format="MM/DD/YY" onfocus="handleDateInputFocus(this)" onblur="handleDateInputBlur(this)" style="width: 100px;" required>
                        </div>
                        <div class="mb-2 d-flex align-items-center">
                            <label for="roct-call-price" class="form-label me-2" style="margin-bottom: 0;">Current Price</label>
                            <div class="input-group input-group-sm" style="width: 100px;">
                                <span class="input-group-text">$</span>
                                <input type="number" class="form-control" id="roct-call-price" step="0.01" placeholder="0.00" onfocus="handleNumberInputFocus(this)" onblur="handleNumberInputBlur(this)" required>
                            </div>
                        </div>
                        <div class="mb-2 d-flex align-items-center">
                            <label for="roct-call-expiration-date" class="form-label me-2" style="margin-bottom: 0;">Expiration Date</label>
                            <input type="text" class="form-control form-control-sm" id="roct-call-expiration-date" name="expirationDate" placeholder="DD-MMM-YY" data-display-format="DD-MMM-YY" data-edit-format="MM/DD/YY" onfocus="handleDateInputFocus(this)" onblur="handleDateInputBlur(this)" style="width: 100px;" required>
                        </div>
                        <div class="mb-2 d-flex align-items-center">
                            <label for="roct-call-dte" class="form-label me-2" style="margin-bottom: 0;">DTE</label>
                            <input type="number" class="form-control form-control-sm" id="roct-call-dte" style="width: 100px;" readonly>
                        </div>
                        <div class="mb-2 d-flex align-items-center">
                            <label for="roct-call-strike-price" class="form-label me-2" style="margin-bottom: 0;">Strike Price</label>
                            <div class="input-group input-group-sm" style="width: 100px;">
                                <span class="input-group-text">$</span>
                                <input type="number" class="form-control" id="roct-call-strike-price" step="0.01" placeholder="0.00" onfocus="handleNumberInputFocus(this)" onblur="handleNumberInputBlur(this)" required>
                            </div>
                        </div>
                        <div class="mb-2 d-flex align-items-center">
                            <label for="roct-call-credit-debit" class="form-label me-2" style="margin-bottom: 0;">Credit</label>
                            <div class="input-group input-group-sm" style="width: 100px;">
                                <span class="input-group-text">$</span>
                                <input type="number" class="form-control" id="roct-call-credit-debit" step="0.01" placeholder="0.00" onfocus="handleNumberInputFocus(this)" onblur="handleNumberInputBlur(this)" required>
                            </div>
                        </div>
                        <div class="mb-2 d-flex align-items-center">
                            <label for="roct-call-cost-basis" class="form-label me-2" style="margin-bottom: 0;">Cost Basis</label>
                            <div class="input-group input-group-sm" style="width: 100px;">
                                <span class="input-group-text">$</span>
                                <input type="number" class="form-control" id="roct-call-cost-basis" step="0.01" placeholder="0.00" readonly>
                            </div>
                        </div>
                        <small class="form-text text-muted" style="font-size: 0.75rem;">Automatically loaded from cost basis table for selected symbol</small>
                    </form>
                </div>
                <div class="modal-footer d-flex flex-column">
                    <div class="d-flex w-100 mb-2" id="roct-call-add-buttons">
                        <button type="button" class="btn btn-primary flex-fill me-2" onclick="submitROCTCallForm('addAndClose')">
                            <i class="fas fa-save me-2"></i>
                            Add and Close
                        </button>
                        <button type="button" class="btn btn-success flex-fill" onclick="submitROCTCallForm('addAnother')">
                            <i class="fas fa-plus me-2"></i>
                            Add Another
                        </button>
                    </div>
                    <div class="d-flex justify-content-center w-100 mb-2" id="roct-call-add-cancel">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <i class="fas fa-times me-2"></i>
                            Cancel
                        </button>
                    </div>
                    <!-- Edit Mode Buttons -->
                    <div class="d-flex w-100 mb-2" id="roct-call-edit-buttons" style="display: none !important;">
                        <button type="button" class="btn btn-primary flex-fill me-2" onclick="submitROCTCallForm('save')">
                            <i class="fas fa-save me-2"></i>
                            Save
                        </button>
                        <button type="button" class="btn btn-secondary flex-fill" data-bs-dismiss="modal">
                            <i class="fas fa-times me-2"></i>
                            Cancel
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Alert Container -->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}?v=382"></script>
    
    <script>
    </script>
</body>
</html>


